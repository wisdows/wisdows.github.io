<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="WisdowsBlog,如果人生有遗憾，那就是没有早点遇到你~">
  <meta name="author" content="Wisdows">
  <meta name="keywords" content="Wisdows, 饶弟, WisdowsBlog, 王者★孤傲">
  <title>JDBC食用指南（二）：数据库连接池的使用 WisdowsBlog WisdowsBlog</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<link rel="alternate" href="/atom.xml" title="WisdowsBlog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>WisdowsBlog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">Categories</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>


</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/16.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期五, 八月 9日 2019, 11:02 晚上
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    6k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      23 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在上一篇文章中我们已经知道了如何简单使用 JDBC 连接数据库，并且设计了一个简单的工具类来方便我们的使用</p>
<p>，最后介绍了一点 JDBC 事务管理的操作。</p>
<p>这篇文章我们就开始进阶使用我们的 JDBC ，体验数据库连接池技术。</p>
<a id="more"></a>

<h2 id="一-使用数据库连接池"><a href="#一-使用数据库连接池" class="headerlink" title="一. 使用数据库连接池"></a>一. 使用数据库连接池</h2><h3 id="1-什么是数据库连接池"><a href="#1-什么是数据库连接池" class="headerlink" title="1. 什么是数据库连接池"></a>1. 什么是数据库连接池</h3><p>百科定义：数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个；释放空闲时间超过最大空闲时间的数据库连接来避免因为没有释放数据库连接而引起的数据库连接遗漏。这项技术能明显提高对数据库操作的性能。</p>
<p>个人理解：每次数据库连接都要申请一个连接对象，这项操作要经过系统底层，相对来说是非常耗时的。我们可以在程序开始时初始化多个数据库连接对象，并将其保留在一个容器（池子）中，该池子中的连接对象可以重复被使用，使用时直接向该容器获取连接对象，使用完后再将连接对象归还给该容器，这个容器（池子）称为数据库连接池。</p>
<h3 id="2-为什么使用数据库连接池"><a href="#2-为什么使用数据库连接池" class="headerlink" title="2. 为什么使用数据库连接池"></a>2. 为什么使用数据库连接池</h3><h4 id="2-1-传统的数据库连接方式"><a href="#2-1-传统的数据库连接方式" class="headerlink" title="2.1 传统的数据库连接方式"></a>2.1 传统的数据库连接方式</h4><p>每一个获取数据库连接对象的操作都需要从系统底层获取资源，申请资源又是一件极度耗时的工作。</p>
<p>每一次使用完这个数据库连接之后，我们又直接将资源释放给系统底层，下次使用还是要重新向系统申请资源。</p>
<p>这样来回反复，会浪费大量的时间以及系统资源。并且，当同时连接数据库的次数数量很大时，此时系统资源和时间都被消耗在数据库连接上，我们想要得到的数据库中的数据的时间就被延迟，这是非常影响用户的体验的。又因为每一次我们使用完数据库连接就要完全释放该连接，在大量的数据库连接中，程序如果出现异常，此时资源并没有完全释放，大量的连接资源没有及时释放，容易发生内存泄漏。</p>
<p>在上述模式下，数据库连接如下图：</p>
<p><img src="/img/JDBCAdvanced/01.png" srcset="undefined" alt=""></p>
<h4 id="2-2-引入数据库连接池后的数据库连接模式"><a href="#2-2-引入数据库连接池后的数据库连接模式" class="headerlink" title="2.2 引入数据库连接池后的数据库连接模式"></a>2.2 引入数据库连接池后的数据库连接模式</h4><p>在上面的分析中我们得知，程序在获取数据库连接时这段操作其实是非常耗时的，而一般的程序运行的速度都很快，如果让程序运行的时间大部分花在等待数据库的连接操作中，这样的程序效率是很低的。</p>
<p>那么有没有办法解决呢？我们可以思考一下，其实解决这个问题的关键点就在于两点：</p>
<ol>
<li>如何解决请求连接对象速度的问题，</li>
<li>如何有效管理大量的连接。</li>
</ol>
<p>我们在学操作系统的时候，许多时候都提到了<strong>缓存</strong>这个技术，缓存的出现就是为了解决速度不匹配的问题。那么在我们这里我们可以这样想，在程序需要请求数据库连接之前我们就把连接对象创建好，此时的连接对象在内存中已经初始化好了，程序只要直接拿就是了，获取连接对象的速度就会快很多。第一个问题解决。</p>
<p>但是当产生大量的连接请求时，此时我们需要初始化多个连接对象，这些连接对象的创建服务于一次请求，用完又被释放掉了，这样会产生大量的资源浪费，而且如果程序出现异常，多个连接对象没有被完全释放，容易造成内存泄漏，这是不可取的。</p>
<p>而在程序设计中，我们有一个知识叫做 <strong>复用性</strong> ,将一样的东西放在一起，然后不同的地方都可以使用。利用这个知识，我们可以引入 <strong>容器（池子）</strong> ，将一定数量建立好的连接对象放入容器中，每次连接都向该容器获取，用完又放回该容器，这样一个对象就可以在不同的时候服务不同的连接；同时，在处理多个连接时，我们可以通过控制容器中最大连接对象的数量，避免无穷无尽的连接请求；通过对容器资源的释放，又可将其中的连接对象资源同时释放。</p>
<p>更关键的是我们可以在容器中加入相应的管理模块和监视模块，可以对其中的连接对象进行管理，方便开发人员进行测试以及优化。</p>
<p>为了实现上述这些想法和操作，人们提出了一个技术：<strong>==数据库连接池==</strong>，其目的就是用来解决和实现我们刚才讨论的这些问题。</p>
<p>在引入数据库连接池后，此时的数据库连接如图：</p>
<p><img src="/img/JDBCAdvanced/02.png" srcset="undefined" alt=""></p>
<p><strong>注意一点</strong>：数据库连接池的实现是在客户端实现的，而不是在服务端的数据库的中实现，在客户端对连接对象进行请求和管理。在数据库端对应也有一个叫做线程池的东西，和连接池的效果都差不多，当然，这都是后话了。</p>
<h4 id="2-3-实现一个简单的数据库连接池"><a href="#2-3-实现一个简单的数据库连接池" class="headerlink" title="2.3 实现一个简单的数据库连接池"></a>2.3 实现一个简单的数据库连接池</h4><p>说了这么多，我们还是来实践一下把，我们接下来就来手动实现一个简单的连接池。</p>
<p>首先我们要确定我们设计的连接池需要实现的目标：</p>
<ol>
<li>一次性创建多个连接对象</li>
<li>新增连接对象</li>
<li>回收连接对象</li>
</ol>
<p>简单实现的代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qianfanguojin</span></span><br><span class="line"><span class="comment"> * 自己简单设计的一个数据库连接池</span></span><br><span class="line"><span class="comment"> * 须实现DataSource接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSource</span> <span class="keyword">implements</span> <span class="title">DataSource</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用链表来存放多个Connection对象</span></span><br><span class="line">        <span class="keyword">private</span> LinkedList&lt;Connection&gt; connectionLinkedList = <span class="keyword">new</span> LinkedList&lt;Connection&gt;();</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 初始化多个连接对象</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyDataSource</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="comment">//初始化十个连接对象，并将其放到链表中</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++ ) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">//注册驱动</span></span><br><span class="line">                    Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">                    <span class="comment">//获取连接对象</span></span><br><span class="line">                    Connection connection = DriverManager.</span><br><span class="line">                            getConnection(<span class="string">"jdbc:mysql://localhost:3306/hk1"</span>, <span class="string">"root"</span>, <span class="string">"987075"</span>);</span><br><span class="line">                    <span class="comment">//将连接对象放到链表（池子）中</span></span><br><span class="line">                    connectionLinkedList.add(connection);</span><br><span class="line">                } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                } <span class="keyword">catch</span> (SQLException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 获得连接池中的一个连接对象</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">            <span class="comment">//返回第一个连接对象，并将该对象从链表中去除</span></span><br><span class="line">            <span class="keyword">return</span> connectionLinkedList.removeFirst();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *将使用完的连接对象回收进连接池</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backConnection</span><span class="params">(Connection conn)</span> </span>{</span><br><span class="line">                connectionLinkedList.add(conn);</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p>测试代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSourceTest</span> </span>{</span><br><span class="line">		<span class="comment">//Junit 单元测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getConnection</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.初始化一个连接池对象</span></span><br><span class="line">        MyDataSource dataSource = <span class="keyword">new</span> MyDataSource();</span><br><span class="line"></span><br><span class="line">        PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//2.获取连接池中的Connection对象</span></span><br><span class="line">            conn = dataSource.getConnection();</span><br><span class="line">            <span class="comment">//3.编写带有占位符 ”?“ 的SQL语句。</span></span><br><span class="line">            String sql = <span class="string">"select * from user where password = ?"</span>;</span><br><span class="line">            <span class="comment">//4.获取SQL语句执行对象并传入带有占位符的sql语句。</span></span><br><span class="line">            pst = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//5. 对占位符进行赋值。</span></span><br><span class="line">            pst.setString(<span class="number">1</span>,<span class="string">"123456"</span>);</span><br><span class="line">            <span class="comment">//6.执行SQL语句，执行组装好的SQL语句。</span></span><br><span class="line">            rs = pst.executeQuery();</span><br><span class="line">            <span class="comment">//7.对执行SQL的结果进行处理</span></span><br><span class="line">            <span class="keyword">while</span>(rs.next()) {</span><br><span class="line">                String user = rs.getString(<span class="string">"user"</span>);</span><br><span class="line">                String pas = rs.getString(<span class="string">"password"</span>);</span><br><span class="line">                System.out.println(<span class="string">"用户名："</span> + user + <span class="string">"    密码："</span> + pas);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (SQLException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            dataSource.backConnection(conn);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>输出结果为：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用户名：小明    密码：<span class="number">123456</span></span><br><span class="line">用户名：小李    密码：<span class="number">123456</span></span><br></pre></td></tr></tbody></table></figure>

<p>说明我们成功通过该数据库连接池获取到连接对象。</p>
<h3 id="3-开发中常用的数据连接池"><a href="#3-开发中常用的数据连接池" class="headerlink" title="3. 开发中常用的数据连接池"></a>3. 开发中常用的数据连接池</h3><p>在上面的示例中，我们自己实现了一个数据库连接池，实现了简单的一些功能。但是在实际开发中，对数据库连接池的功能要求更全面，一般来说，数据库厂商也会在驱动包中集成实现了 <code>DataSource</code>接口的数据库连接池，而在开源平台中，也有许多优秀的数据库连接池实现，如：</p>
<ul>
<li><a href="https://github.com/swaldman/c3p0" target="_blank" rel="noopener">c3p0</a>： 优秀的开源数据库连接池包，但是年代比较老了。</li>
<li>Druid(德鲁伊)： 阿里开源的数据库连接池包，支付宝和淘宝也在使用，后起之秀。</li>
</ul>
<p>接下来我们就学习一下他们的使用方式。</p>
<h4 id="3-1-使用C3P0"><a href="#3-1-使用C3P0" class="headerlink" title="3.1 使用C3P0"></a>3.1 使用C3P0</h4><p>官方文档地址：<a href="https://www.mchange.com/projects/c3p0/#quickstart" target="_blank" rel="noopener">https://www.mchange.com/projects/c3p0/#quickstart</a> 我们可以从中得到使用信息。</p>
<h5 id="step1-导入相关-jar-包"><a href="#step1-导入相关-jar-包" class="headerlink" title="step1. 导入相关 jar 包"></a>step1. 导入相关 jar 包</h5><p>不管是使用什么开源库，导包都是第一步。查看c3p0的官方文档，有这么一句：</p>
<blockquote>
<p>c3p0 was designed to be butt-simple to use. Just put the files <code>lib/c3p0-0.9.5.2.jar</code> and <code>lib/mchange-commons-java-0.2.15.jar</code> in your application’s effective <code>CLASSPATH</code></p>
</blockquote>
<p>大致意思就是 c3p0 使用很方便，将<code>c3p0-0.9.5.2.jar</code> 和<code>mchange-commons-java-0.2.15.jar</code>放到应用的环境变量中即可。</p>
<p>这里就告诉我们需要导入上述两个包到我们的项目中。这两个包的下载地址分别为：</p>
<p><a href="https://mvnrepository.com/artifact/com.mchange/c3p0/0.9.5.2" target="_blank" rel="noopener">c3p0-0.9.5.2.jar</a></p>
<p><a href="https://mvnrepository.com/artifact/com.mchange/mchange-commons-java/0.2.15" target="_blank" rel="noopener">mchange-commons-java-0.2.15.jar</a></p>
<p>然后我们在我们的 src 同级目录新建一个 libs 目录用于存放所有的 jar包 并将上面的两个 jar 包复制进来，此时目录结构如下：</p>
<p><img src="/img/JDBCAdvanced/03.png" srcset="undefined" alt=""></p>
<p>然后右键点击<code>c3p0-0.9.5.2.jar</code>文件，在弹出的菜单栏中靠下部分点击 <code>Add as Library</code> ,然后在弹出的弹窗中点击 OK ,就可将其导入项目的 <code>ClassPath</code>中。</p>
<p>相应的，对 <code>mchange-commons-java-0.2.15.jar</code>也执行相同的步骤。操作完成后，我们可以展开该包查看其中的信息，说明导入成功：</p>
<p><img src="/img/JDBCAdvanced/04.png" srcset="undefined" alt=""></p>
<p>当然数据库连接驱动就不用多说了，一定也要导入的，这里我就不再细述了。</p>
<h5 id="step2-定义配置文件"><a href="#step2-定义配置文件" class="headerlink" title="step2. 定义配置文件"></a>step2. 定义配置文件</h5><p>使用c3p0 有两种方式，一种是硬编码，也就是配置都写在代码里，如官方文档中示例：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ComboPooledDataSource cpds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">cpds.setDriverClass( <span class="string">"org.postgresql.Driver"</span> ); <span class="comment">//loads the jdbc driver            </span></span><br><span class="line">cpds.setJdbcUrl( <span class="string">"jdbc:postgresql://localhost/testdb"</span> );</span><br><span class="line">cpds.setUser(<span class="string">"dbuser"</span>);                                  </span><br><span class="line">cpds.setPassword(<span class="string">"dbpassword"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>但是很明显，这样的写法有许多缺点。一是代码冗余性多，二是将来代码维护的时候非常麻烦，所以我们更推荐使用配置文件的模式。</p>
<p>查看官方文档，在配置文件栏可以找到这句：</p>
<blockquote>
<p>Configuration files are normally looked up under standard names (<code>c3p0.properties</code> or <code>c3p0-config.xml</code>) at the top level of an application’s classpath, but the XML configuration can be placed anywhere in an application’s file system or classpath, if the system property <a href="https://www.mchange.com/projects/c3p0/#locating_configuration_information" target="_blank" rel="noopener"><code>com.mchange.v2.c3p0.cfg.xml</code></a> is set.</p>
</blockquote>
<p>大致意思就是：通常来说配置文件的名字都应设为<code>c3p0.properties</code>或者<code>c3p0-config.xml</code>，而且该文件的位置应该在 classpath （类路径）目录，也就是 src 目录下。如果<code>com.mchange.v2.c3p0.cfg.xml</code> 指定了XML位置的话，XML文件也可以放在任意目录下。</p>
<p>根据以上信息，我们直接在 src 目录下新建<code>c3p0-config.xml</code>文件，添加如下内容：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--c3p0配置信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    默认配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default-config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--连接参数--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span>&gt;</span>jdbc:mysql://localhost:3306/hk1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>987075<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--初始化连接池中申请的连接对象数量--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池中最大的连接数量--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池中最小的连接数量--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 超时时间(ms)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">default-config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--附加配置，配置不同的数据库厂商 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">named-config</span> <span class="attr">name</span>=<span class="string">"mySource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span>&gt;</span>jdbc:mysql://localhost:3306/bookstore<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>xxxx<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">named-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c3p0-config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>这样做完后，数据库连接池的配置文件就准备完成。</p>
<h5 id="step3-使用示例"><a href="#step3-使用示例" class="headerlink" title="step3. 使用示例"></a>step3. 使用示例</h5><p>配置文件配好了，那么我们就用一个简单的示例来体验一下吧。</p>
<p>添加代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * C3P0 的简单示例</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C3P0Demo</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//1.创建数据库连接池对象</span></span><br><span class="line">        DataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">        <span class="comment">//2.获取连接对象</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Connection conn = ds.getConnection();</span><br><span class="line">            System.out.println(conn);</span><br><span class="line">        } <span class="keyword">catch</span> (SQLException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>输出结果：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.mchange.v2.c3p0.impl.NewProxyConnection@<span class="number">5f</span>e5c6f [wrapping: com.mysql.jdbc.JDBC4Connection@<span class="number">6979e8</span>cb]</span><br></pre></td></tr></tbody></table></figure>

<p><strong>注意：</strong></p>
<blockquote>
<p>在不传参情况下，<code>new ComboPooledDataSource()</code> 创建对象使用默认构造函数，此时使用的配置为配置文件中的 <code>default-config</code> ，但我们也可以在创建对象时传入参数指定配置：<code>new ComboPooledDataSource("mySource")</code> 则指定配置文件中名为<code>mySource</code> 的配置，这样我们可以方便的在使用不同的数据库时切换不同的配置。</p>
</blockquote>
<h4 id="3-2-使用Druid"><a href="#3-2-使用Druid" class="headerlink" title="3.2 使用Druid"></a>3.2 使用Druid</h4><p>Druid 是阿里巴巴开源的一个高效的连接池实现，凭借其各方面优秀的特性，已经成为最热门的数据库连接池实现之一。</p>
<p>官方文档：<a href="https://github.com/alibaba/druid/wiki/首页" target="_blank" rel="noopener">https://github.com/alibaba/druid/wiki/%E9%A6%96%E9%A1%B5</a></p>
<p>我们推荐使用Druid来使用数据库连接池。</p>
<p>下面是其使用的简单步骤：</p>
<h5 id="step1-导入-jar-包"><a href="#step1-导入-jar-包" class="headerlink" title="step1. 导入 jar 包"></a>step1. 导入 jar 包</h5><p>导包的操作和上面C3P0的方式一样，这里不再细述，这里给出Druid jar 包下载地址：</p>
<p><a href="https://mvnrepository.com/artifact/com.alibaba/druid/1.1.10" target="_blank" rel="noopener">druid-1.1.10.jar</a></p>
<h5 id="step2-使用配置文件"><a href="#step2-使用配置文件" class="headerlink" title="step2. 使用配置文件"></a>step2. 使用配置文件</h5><p>在Druid官方文档的说明中， DataSource连接池可配置的属性列表和说明如下：</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>缺省值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td></td>
<td>配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。如果没有配置，将会生成一个名字，格式是：”DataSource-“ + System.identityHashCode(this). 另外配置此属性至少在1.0.5版本中是不起作用的，强行设置name会出错。<a href="http://blog.csdn.net/lanmo555/article/details/41248763" target="_blank" rel="noopener">详情-点此处</a>。</td>
</tr>
<tr>
<td>url</td>
<td></td>
<td>连接数据库的url，不同数据库不一样。例如：<br>mysql : jdbc:mysql://10.20.153.104:3306/druid2<br> oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto</td>
</tr>
<tr>
<td>username</td>
<td></td>
<td>连接数据库的用户名</td>
</tr>
<tr>
<td>password</td>
<td></td>
<td>连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用ConfigFilter。<a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter" target="_blank" rel="noopener">详细看这里</a></td>
</tr>
<tr>
<td>driverClassName</td>
<td>根据url自动识别</td>
<td>这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName</td>
</tr>
<tr>
<td>initialSize</td>
<td>0</td>
<td>初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时</td>
</tr>
<tr>
<td>maxActive</td>
<td>8</td>
<td>最大连接池数量</td>
</tr>
<tr>
<td>maxIdle</td>
<td>8</td>
<td>已经不再使用，配置了也没效果</td>
</tr>
<tr>
<td>minIdle</td>
<td></td>
<td>最小连接池数量</td>
</tr>
<tr>
<td>maxWait</td>
<td></td>
<td>获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>false</td>
<td>是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。</td>
</tr>
<tr>
<td>maxPoolPreparedStatementPerConnectionSize</td>
<td>-1</td>
<td>要启用PSCache，必须配置大于0，当大于0时，poolPreparedStatements自动触发修改为true。在Druid中，不会存在Oracle下PSCache占用内存过多的问题，可以把这个数值配置大一些，比如说100</td>
</tr>
<tr>
<td>validationQuery</td>
<td></td>
<td>用来检测连接是否有效的sql，要求是一个查询语句，常用select ‘x’。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会起作用。</td>
</tr>
<tr>
<td>validationQueryTimeout</td>
<td></td>
<td>单位：秒，检测连接是否有效的超时时间。底层调用jdbc Statement对象的void setQueryTimeout(int seconds)方法</td>
</tr>
<tr>
<td>testOnBorrow</td>
<td>true</td>
<td>申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</td>
</tr>
<tr>
<td>testOnReturn</td>
<td>false</td>
<td>归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</td>
</tr>
<tr>
<td>testWhileIdle</td>
<td>false</td>
<td>建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</td>
</tr>
<tr>
<td>keepAlive</td>
<td>false<br>（1.0.28）</td>
<td>连接池中的minIdle数量以内的连接，空闲时间超过minEvictableIdleTimeMillis，则会执行keepAlive操作。</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td>1分钟（1.0.14）</td>
<td>有两个含义：<br>1) Destroy线程会检测连接的间隔时间，如果连接空闲时间大于等于minEvictableIdleTimeMillis则关闭物理连接。<br>2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明</td>
</tr>
<tr>
<td>numTestsPerEvictionRun</td>
<td>30分钟（1.0.14）</td>
<td>不再使用，一个DruidDataSource只支持一个EvictionRun</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td></td>
<td>连接保持空闲而不被驱逐的最小时间</td>
</tr>
<tr>
<td>connectionInitSqls</td>
<td></td>
<td>物理连接初始化的时候执行的sql</td>
</tr>
<tr>
<td>exceptionSorter</td>
<td>根据dbType自动识别</td>
<td>当数据库抛出一些不可恢复的异常时，抛弃连接</td>
</tr>
<tr>
<td>filters</td>
<td></td>
<td>属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有：<br>监控统计用的filter:stat<br>日志用的filter:log4j<br>防御sql注入的filter:wall</td>
</tr>
<tr>
<td>proxyFilters</td>
<td></td>
<td>类型是List&lt;com.alibaba.druid.filter.Filter&gt;，如果同时配置了filters和proxyFilters，是组合关系，并非替换关系</td>
</tr>
</tbody></table>
<p>与上面的 C3P0 一样，这些属性也可以硬编码式的直接在代码里通过不同的 setXX() 方法设置，但不推荐。我们都推荐使用配置文件的方式，在这里，我们需要使用 Java配置文件格式 properties 来配置相应的连接池属性。</p>
<p>在 src 目录（也可以任意目录下）下，新建文件名为 druid.properties 的File文件，在里面填入一些必要的配置属性即可： </p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 驱动位置</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment"># 连接路径</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/hk1</span></span><br><span class="line"><span class="comment"># 数据库用户名</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"># 数据库密码</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">987075</span></span><br><span class="line"><span class="comment"># 初始化时连接池连接对象的数量</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="comment"># 连接池最大连接数量</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">10</span></span><br></pre></td></tr></tbody></table></figure>

<h5 id="step3-使用示例-1"><a href="#step3-使用示例-1" class="headerlink" title="step3. 使用示例"></a>step3. 使用示例</h5><p>定义好配置文件后，我们同样使用一个简单示例来介绍使用方式：</p>
<p>使用示例如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Druid 数据库连接池的简单示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidDemo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取配置文件</span></span><br><span class="line">        Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">        InputStream in = DruidDemo.class.getClassLoader().getResourceAsStream("druid.properties");</span><br><span class="line">        pro.load(in);</span><br><span class="line">        System.out.println(pro);</span><br><span class="line">        <span class="comment">//2.创建数据库连接池对象</span></span><br><span class="line">        <span class="comment">//需要传入properties对象获取其中的配置信息</span></span><br><span class="line">        DataSource ds = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.获取连接对象</span></span><br><span class="line">        Connection conn = ds.getConnection();</span><br><span class="line">        System.out.println(conn);</span><br><span class="line">      	<span class="comment">//4.将连接对象放回连接池</span></span><br><span class="line">        <span class="comment">//使用了连接池时,close方法功能为连接对象退回连接池</span></span><br><span class="line">        conn.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>输出结果为：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{maxActive=10, password=987075, url=jdbc:mysql://localhost:3306/hk1, driverClassName=com.mysql.jdbc.Driver, initialSize=5, username=root}</span><br><span class="line">信息: {dataSource-1} inited</span><br><span class="line">com.mysql.jdbc.JDBC4Connection@42f93a98</span><br></pre></td></tr></tbody></table></figure>

<p>成功获取到了连接对象。</p>
<p>具体的步骤解析注释中已经介绍的很清楚了，我就不再细述了。</p>
<h2 id="二、设计结合了数据库连接池的工具类JDBCUtils"><a href="#二、设计结合了数据库连接池的工具类JDBCUtils" class="headerlink" title="二、设计结合了数据库连接池的工具类JDBCUtils"></a>二、设计结合了数据库连接池的工具类JDBCUtils</h2><p>前面我们设计了基本的 JDBCUtils 工具类，其可以帮我们简化代码，增加加代码的复用性…。在引入数据库连接池后，我们再来梳理以下我们工具类的功能：</p>
<ul>
<li>初始化数据库连接池</li>
<li>获取连接对象</li>
<li>关闭连接，并将连接对象退回连接池</li>
</ul>
<p>接下来就是各个功能的实现：</p>
<h3 id="f1-初始化数据库连接池"><a href="#f1-初始化数据库连接池" class="headerlink" title="f1. 初始化数据库连接池"></a>f1. 初始化数据库连接池</h3><p>一般来说，初始化的操作都只要执行一次而且是最早执行越好。于是我们初始化的代码可以放在 <code>static</code> 代码块中，具体的实现如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//数据库连接池引用</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 静态代码块，负责连接池的初始化操作</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> {</span><br><span class="line">      Properties pro = <span class="keyword">null</span>;</span><br><span class="line">      InputStream in = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">          <span class="comment">//1.加载配置文件，从中获取连接池的属性配置</span></span><br><span class="line">          pro = <span class="keyword">new</span> Properties();</span><br><span class="line">          in = JDBCUtils<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span></span><br><span class="line">                  .getResourceAsStream("druid.properties");</span><br><span class="line">          pro.load(in);</span><br><span class="line"></span><br><span class="line">          <span class="comment">//2.建立Druid数据库连接池并指定配置</span></span><br><span class="line">          dataSource = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line"></span><br><span class="line">      } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="f2-获取连接对象"><a href="#f2-获取连接对象" class="headerlink" title="f2. 获取连接对象"></a>f2. 获取连接对象</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接池</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接池的引用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>附加一个获取连接池的方法：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取连接池</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> 连接池的引用</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="f3-关闭连接，并将连接对象退回连接池"><a href="#f3-关闭连接，并将连接对象退回连接池" class="headerlink" title="f3. 关闭连接，并将连接对象退回连接池"></a>f3. 关闭连接，并将连接对象退回连接池</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关闭资源，连接对象会被归还进连接池</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> pst</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(ResultSet rs, PreparedStatement pst, Connection conn)</span></span>{</span><br><span class="line">      <span class="comment">//关闭结果集对象</span></span><br><span class="line">      <span class="comment">//释放前应该判断对象是否为空，不为空再执行关闭操作，避免空指针异常</span></span><br><span class="line">      <span class="keyword">if</span>(rs != <span class="keyword">null</span>){</span><br><span class="line">          <span class="keyword">try</span>{</span><br><span class="line">              rs.close();</span><br><span class="line">          }<span class="keyword">catch</span> (SQLException e){</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">//关闭数据库操作对象</span></span><br><span class="line">      <span class="keyword">if</span>(pst != <span class="keyword">null</span>){</span><br><span class="line">          <span class="keyword">try</span>{</span><br><span class="line">              pst.close();</span><br><span class="line">          }<span class="keyword">catch</span> (SQLException e){</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">//关闭本次连接，连接对象退回连接池</span></span><br><span class="line">      <span class="keyword">if</span>(conn != <span class="keyword">null</span>){</span><br><span class="line">          <span class="keyword">try</span>{</span><br><span class="line">              conn.close();</span><br><span class="line">          }<span class="keyword">catch</span> (SQLException e){</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关闭资源，连接对象会被归还进连接池</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> pst</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(PreparedStatement pst,Connection conn)</span></span>{</span><br><span class="line">      <span class="comment">//调用三参的方法，将第一个参数设为null，间接关闭两个对象</span></span><br><span class="line">      close(<span class="keyword">null</span>,pst,conn);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="工具类功能合并及测试"><a href="#工具类功能合并及测试" class="headerlink" title="工具类功能合并及测试"></a>工具类功能合并及测试</h3><p>通过上面的步骤，我们的一个 JDBC工具类就设计完成了，整合后的代码为：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qianfanguojin</span></span><br><span class="line"><span class="comment"> * 引入Druid数据库连接池后的JDBC工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtils</span> </span>{</span><br><span class="line">    <span class="comment">//数据库连接池引用</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态代码块，负责连接池的初始化操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        Properties pro = <span class="keyword">null</span>;</span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//1.加载配置文件，从中获取连接池的属性配置</span></span><br><span class="line">            pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            in = JDBCUtils<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span></span><br><span class="line">                    .getResourceAsStream("druid.properties");</span><br><span class="line">            pro.load(in);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.建立Druid数据库连接池并指定配置</span></span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接池</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接池的引用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从连接池中获取一个连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 连接池中的一个连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">        <span class="keyword">return</span> dataSource.getConnection();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭资源，连接对象会被归还进连接池</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pst</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(ResultSet rs, PreparedStatement pst, Connection conn)</span></span>{</span><br><span class="line">        <span class="comment">//关闭结果集对象</span></span><br><span class="line">        <span class="comment">//释放前应该判断对象是否为空，不为空再执行关闭操作，避免空指针异常</span></span><br><span class="line">        <span class="keyword">if</span>(rs != <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">try</span>{</span><br><span class="line">                rs.close();</span><br><span class="line">            }<span class="keyword">catch</span> (SQLException e){</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭数据库操作对象</span></span><br><span class="line">        <span class="keyword">if</span>(pst != <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">try</span>{</span><br><span class="line">                pst.close();</span><br><span class="line">            }<span class="keyword">catch</span> (SQLException e){</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭本次连接，连接对象退回连接池</span></span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">try</span>{</span><br><span class="line">                conn.close();</span><br><span class="line">            }<span class="keyword">catch</span> (SQLException e){</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭资源，连接对象会被归还进连接池</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pst</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(PreparedStatement pst,Connection conn)</span></span>{</span><br><span class="line">        <span class="comment">//调用三参的方法，将第一个参数设为null，间接关闭两个对象</span></span><br><span class="line">        close(<span class="keyword">null</span>,pst,conn);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>然后我们使用一个小示例来测试：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qianfanguojin</span></span><br><span class="line"><span class="comment"> * 测试工具类的使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtilsDemo</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//1. 从连接池获得连接对象</span></span><br><span class="line">            conn = JDBCUtils.getConnection();</span><br><span class="line">            <span class="comment">//2.构建带占位符的SQL语句</span></span><br><span class="line">            String sql = <span class="string">"select * from user where password = ?"</span>;</span><br><span class="line">            <span class="comment">//4.获取SQL语句执行对象并传入带有占位符的sql语句。</span></span><br><span class="line">            pst = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//5. 对占位符进行赋值。</span></span><br><span class="line">            pst.setString(<span class="number">1</span>,<span class="string">"123456"</span>);</span><br><span class="line">            <span class="comment">//6.执行SQL语句，执行组装好的SQL语句。</span></span><br><span class="line">            rs = pst.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//7.对执行SQL的结果进行处理</span></span><br><span class="line">            <span class="keyword">while</span>(rs.next()) {</span><br><span class="line">                String user = rs.getString(<span class="string">"user"</span>);</span><br><span class="line">                String pas = rs.getString(<span class="string">"password"</span>);</span><br><span class="line">                System.out.println(<span class="string">"用户名："</span> + user + <span class="string">"    密码："</span> + pas);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (SQLException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">//8.关闭资源</span></span><br><span class="line">            JDBCUtils.close(rs,pst,conn);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>输出结果：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用户名：小明    密码：<span class="number">123456</span></span><br><span class="line">用户名：小李    密码：<span class="number">123456</span></span><br></pre></td></tr></tbody></table></figure>



<p>OK ，本节到这里结束。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="https://blog.csdn.net/shuaihj/article/details/14223015" target="_blank" rel="noopener"><strong>谈谈数据库连接池的原理</strong></a></p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/Java">Java</a>
                  &nbsp;
                
                  <a class="hover-with-bg" href="/categories/JDBC">JDBC</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/Java">Java</a>
                
                  <a class="hover-with-bg" href="/tags/JDBC">JDBC</a>
                
                  <a class="hover-with-bg" href="/tags/JDBC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0">JDBC数据库连接池</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  




  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "JDBC食用指南（二）：数据库连接池的使用&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>







</body>
</html>
