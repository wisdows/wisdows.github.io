<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="WisdowsBlog,如果人生有遗憾，那就是没有早点遇到你~">
  <meta name="author" content="Wisdows">
  <meta name="keywords" content="Wisdows, 饶弟, WisdowsBlog, 王者★孤傲">
  <title>【Android】懒加载的ViewPager+自适应高度 WisdowsBlog WisdowsBlog</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<link rel="alternate" href="/atom.xml" title="WisdowsBlog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>WisdowsBlog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">Categories</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>


</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/16.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期二, 十二月 5日 2017, 3:18 下午
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    7k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      41 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <p>viewpager组件在Android中使用的场景还是很多的，占据着重要的地位，比如APP中的banner、tab页面、图片的预览等地方，随处都可见，Android版本的微信主页就是使用的是Viewpager来加载视图的。</p>
<a id="more"></a>

<h1 id="改善Viewpager的预加载"><a href="#改善Viewpager的预加载" class="headerlink" title="改善Viewpager的预加载"></a>改善Viewpager的预加载</h1><p>ViewPager的源码中，默认会加载下一页的Viewpager的内容，也就是说在初次进入的时候，下一页的内容就已经被加载出来了，并且源码中对于此项设置并不能取消掉，但有时候我们并不需要其预加载下一页的内容，通常方法有两种。</p>
<h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>网上大多数说法是 懒加载，即让ViewPager预加载初始化UI，而具体一些数据，网络访问请求等延迟加载。这是靠Fragment里有一个setUserVisibleHint(boolean isVisibleToUser)的方法，我们可以在这个方法里做判断，当其True可见时（即切换到某一个具体Fragment）时才去加载数据，这样可以省流量。但这里并不满足我的需求，因为某一个Fragment并不会在ViewPager滑动到其相邻的Fragment时销毁。这个只可以解决部分人问题。</p>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>重新写一份ViewPager 和源码保持一致,把原生ViewPager全拷过来，修改这个DEFAULT_OFFSCREEN_PAGES 值为0。对，就是这种解决方案！！但是！！<br>但是！！！但是什么呢？但是我试过，没用。为什么呢？接下来就是本文的重点了。<br>因为现在android都6.0了，版本都老高了，其实android虽然每个版本都有v4包，但是这些v4包是有差异的。这就造成高版本v4包里的ViewPager，即使你Copy它，将其DEFAULT_OFFSCREEN_PAGES的值改为0，还是不起作用的，其中的逻辑变了。具体哪里变了导致无效我也没有继续研究了，毕竟公司不会花时间让我研究这些啊。</p>
<p><strong>完美解决方案：</strong> ok，所以关于禁止ViewPager预加载的完美解决方案就是，使用低版本v4包里的ViewPager，完全copy一份，将其中的DEFAULT_OFFSCREEN_PAGES值改为0即可。博主亲测 API 14 即 Android 4.0的v4包里ViewPager 有效。</p>
<p>当然，谷歌既然有这么一种ViewPager的机制肯定有它的道理，所以一般还是预加载的好。<br>最后，因为低版本的源码越来越少的人会去下载，这里直接把这个禁止了预加载的ViewPager贴上来，需要的人就拿去吧。copy就能用了。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sdr.binjiang.widget;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.DataSetObserver;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Rect;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</span><br><span class="line"><span class="keyword">import</span> android.os.Parcel;</span><br><span class="line"><span class="keyword">import</span> android.os.Parcelable;</span><br><span class="line"><span class="keyword">import</span> android.os.SystemClock;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.os.ParcelableCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.os.ParcelableCompatCreatorCallbacks;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.KeyEventCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.MotionEventCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.PagerAdapter;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.VelocityTrackerCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.ViewCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.view.ViewConfigurationCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.widget.EdgeEffectCompat;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.FocusFinder;</span><br><span class="line"><span class="keyword">import</span> android.view.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.SoundEffectConstants;</span><br><span class="line"><span class="keyword">import</span> android.view.VelocityTracker;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewConfiguration;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewParent;</span><br><span class="line"><span class="keyword">import</span> android.view.accessibility.AccessibilityEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.Interpolator;</span><br><span class="line"><span class="keyword">import</span> android.widget.Scroller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Layout manager that allows the user to flip left and right through pages of</span></span><br><span class="line"><span class="comment"> * data. You supply an implementation of a</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> android.support.v4.view.PagerAdapter} to generate the pages that the</span></span><br><span class="line"><span class="comment"> * view shows.</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Note this class is currently under early design and development. The API will</span></span><br><span class="line"><span class="comment"> * likely change in later updates of the compatibility library, requiring</span></span><br><span class="line"><span class="comment"> * changes to the source code of apps when they are compiled against the newer</span></span><br><span class="line"><span class="comment"> * version.</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyViewPager</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"LazyViewPager"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DEBUG = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> USE_CACHE = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_OFFSCREEN_PAGES = <span class="number">0</span>;<span class="comment">// 默认的加载页面,ViewPager是1个,所以会加载两个Fragment</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SETTLE_DURATION = <span class="number">600</span>; <span class="comment">// ms</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemInfo</span> </span>{</span><br><span class="line">        Object object;</span><br><span class="line">        <span class="keyword">int</span> position;</span><br><span class="line">        <span class="keyword">boolean</span> scrolling;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;ItemInfo&gt; COMPARATOR = <span class="keyword">new</span> Comparator&lt;ItemInfo&gt;() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(ItemInfo lhs, ItemInfo rhs)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> lhs.position - rhs.position;</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Interpolator sInterpolator = <span class="keyword">new</span> Interpolator() {</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> t)</span> </span>{</span><br><span class="line">            <span class="comment">// _o(t) = t * t * ((tension + 1) * t + tension)</span></span><br><span class="line">            <span class="comment">// o(t) = _o(t - 1) + 1</span></span><br><span class="line">            t -= <span class="number">1.0f</span>;</span><br><span class="line">            <span class="keyword">return</span> t * t * t + <span class="number">1.0f</span>;</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;ItemInfo&gt; mItems = <span class="keyword">new</span> ArrayList&lt;ItemInfo&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PagerAdapter mAdapter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurItem; <span class="comment">// Index of currently displayed page.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRestoredCurItem = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Parcelable mRestoredAdapterState = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> ClassLoader mRestoredClassLoader = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Scroller mScroller;</span><br><span class="line">    <span class="keyword">private</span> PagerObserver mObserver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mPageMargin;</span><br><span class="line">    <span class="keyword">private</span> Drawable mMarginDrawable;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChildWidthMeasureSpec;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChildHeightMeasureSpec;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mInLayout;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mScrollingCacheEnabled;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mPopulatePending;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mScrolling;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mOffscreenPageLimit = DEFAULT_OFFSCREEN_PAGES;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsBeingDragged;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsUnableToDrag;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTouchSlop;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mInitialMotionX;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Position of the last motion event.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mLastMotionX;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mLastMotionY;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ID of the active pointer. This is used to retain consistency during</span></span><br><span class="line"><span class="comment">     * drags/flings if multiple pointers are used.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mActivePointerId = INVALID_POINTER;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sentinel value for no current active pointer. Used by</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> #mActivePointerId}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INVALID_POINTER = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Determines speed during touch scrolling</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> VelocityTracker mVelocityTracker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mMinimumVelocity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mMaximumVelocity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mBaseLineFlingVelocity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mFlingVelocityInfluence;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mFakeDragging;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mFakeDragBeginTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EdgeEffectCompat mLeftEdge;</span><br><span class="line">    <span class="keyword">private</span> EdgeEffectCompat mRightEdge;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mFirstLayout = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OnPageChangeListener mOnPageChangeListener;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Indicates that the pager is in an idle, settled state. The current page</span></span><br><span class="line"><span class="comment">     * is fully in view and no animation is in progress.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_STATE_IDLE = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Indicates that the pager is currently being dragged by the user.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_STATE_DRAGGING = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Indicates that the pager is in the process of settling to a final</span></span><br><span class="line"><span class="comment">     * position.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_STATE_SETTLING = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mScrollState = SCROLL_STATE_IDLE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Callback interface for responding to changing state of the selected page.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnPageChangeListener</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * This method will be invoked when the current page is scrolled, either</span></span><br><span class="line"><span class="comment">         * as part of a programmatically initiated smooth scroll or a user</span></span><br><span class="line"><span class="comment">         * initiated touch scroll.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> position             Position index of the first page currently being</span></span><br><span class="line"><span class="comment">         *                             displayed. Page position+1 will be visible if</span></span><br><span class="line"><span class="comment">         *                             positionOffset is nonzero.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> positionOffset       Value from [0, 1) indicating the offset from the page at</span></span><br><span class="line"><span class="comment">         *                             position.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> positionOffsetPixels Value in pixels indicating the offset from position.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">int</span> positionOffsetPixels)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * This method will be invoked when a new page becomes selected.</span></span><br><span class="line"><span class="comment">         * Animation is not necessarily complete.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> position Position index of the new selected page.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Called when the scroll state changes. Useful for discovering when the</span></span><br><span class="line"><span class="comment">         * user begins dragging, when the pager is automatically settling to the</span></span><br><span class="line"><span class="comment">         * current page, or when it is fully stopped/idle.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> state The new scroll state.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> android.support.v4.view.ViewPager#SCROLL_STATE_IDLE</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> android.support.v4.view.ViewPager#SCROLL_STATE_DRAGGING</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> android.support.v4.view.ViewPager#SCROLL_STATE_SETTLING</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span class="params">(<span class="keyword">int</span> state)</span></span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Simple implementation of the</span></span><br><span class="line"><span class="comment">     * interface with stub implementations of each method. Extend this if you do</span></span><br><span class="line"><span class="comment">     * not intend to override every method of</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleOnPageChangeListener</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class">            <span class="title">OnPageChangeListener</span> </span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">int</span> positionOffsetPixels)</span> </span>{</span><br><span class="line">            <span class="comment">// This space for rent</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>{</span><br><span class="line">            <span class="comment">// This space for rent</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>{</span><br><span class="line">            <span class="comment">// This space for rent</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LazyViewPager</span><span class="params">(Context context)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        initViewPager();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LazyViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        initViewPager();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initViewPager</span><span class="params">()</span> </span>{</span><br><span class="line">        setWillNotDraw(<span class="keyword">false</span>);</span><br><span class="line">        setDescendantFocusability(FOCUS_AFTER_DESCENDANTS);</span><br><span class="line">        setFocusable(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">final</span> Context context = getContext();</span><br><span class="line">        mScroller = <span class="keyword">new</span> Scroller(context, sInterpolator);</span><br><span class="line">        <span class="keyword">final</span> ViewConfiguration configuration = ViewConfiguration.get(context);</span><br><span class="line">        mTouchSlop = ViewConfigurationCompat</span><br><span class="line">                .getScaledPagingTouchSlop(configuration);</span><br><span class="line">        mMinimumVelocity = configuration.getScaledMinimumFlingVelocity();</span><br><span class="line">        mMaximumVelocity = configuration.getScaledMaximumFlingVelocity();</span><br><span class="line">        mLeftEdge = <span class="keyword">new</span> EdgeEffectCompat(context);</span><br><span class="line">        mRightEdge = <span class="keyword">new</span> EdgeEffectCompat(context);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> density = context.getResources().getDisplayMetrics().density;</span><br><span class="line">        mBaseLineFlingVelocity = <span class="number">2500.0f</span> * density;</span><br><span class="line">        mFlingVelocityInfluence = <span class="number">0.4f</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setScrollState</span><span class="params">(<span class="keyword">int</span> newState)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mScrollState == newState) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        mScrollState = newState;</span><br><span class="line">        <span class="keyword">if</span> (mOnPageChangeListener != <span class="keyword">null</span>) {</span><br><span class="line">            mOnPageChangeListener.onPageScrollStateChanged(newState);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PagerAdapter adapter)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span>) {</span><br><span class="line">            mAdapter.unregisterDataSetObserver(mObserver);</span><br><span class="line">            mAdapter.startUpdate(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">                <span class="keyword">final</span> ItemInfo ii = mItems.get(i);</span><br><span class="line">                mAdapter.destroyItem(<span class="keyword">this</span>, ii.position, ii.object);</span><br><span class="line">            }</span><br><span class="line">            mAdapter.finishUpdate(<span class="keyword">this</span>);</span><br><span class="line">            mItems.clear();</span><br><span class="line">            removeAllViews();</span><br><span class="line">            mCurItem = <span class="number">0</span>;</span><br><span class="line">            scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        mAdapter = adapter;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (mObserver == <span class="keyword">null</span>) {</span><br><span class="line">                mObserver = <span class="keyword">new</span> PagerObserver();</span><br><span class="line">            }</span><br><span class="line">            mAdapter.registerDataSetObserver(mObserver);</span><br><span class="line">            mPopulatePending = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (mRestoredCurItem &gt;= <span class="number">0</span>) {</span><br><span class="line">                mAdapter.restoreState(mRestoredAdapterState,</span><br><span class="line">                        mRestoredClassLoader);</span><br><span class="line">                setCurrentItemInternal(mRestoredCurItem, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">                mRestoredCurItem = -<span class="number">1</span>;</span><br><span class="line">                mRestoredAdapterState = <span class="keyword">null</span>;</span><br><span class="line">                mRestoredClassLoader = <span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                populate();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PagerAdapter <span class="title">getAdapter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mAdapter;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the currently selected page. If the ViewPager has already been</span></span><br><span class="line"><span class="comment">     * through its first layout there will be a smooth animated transition</span></span><br><span class="line"><span class="comment">     * between the current item and the specified item.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item Item index to select</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentItem</span><span class="params">(<span class="keyword">int</span> item)</span> </span>{</span><br><span class="line">        mPopulatePending = <span class="keyword">false</span>;</span><br><span class="line">        setCurrentItemInternal(item, !mFirstLayout, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the currently selected page.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item         Item index to select</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smoothScroll True to smoothly scroll to the new item, false to transition</span></span><br><span class="line"><span class="comment">     *                     immediately</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentItem</span><span class="params">(<span class="keyword">int</span> item, <span class="keyword">boolean</span> smoothScroll)</span> </span>{</span><br><span class="line">        mPopulatePending = <span class="keyword">false</span>;</span><br><span class="line">        setCurrentItemInternal(item, smoothScroll, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentItem</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mCurItem;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCurrentItemInternal</span><span class="params">(<span class="keyword">int</span> item, <span class="keyword">boolean</span> smoothScroll, <span class="keyword">boolean</span> always)</span> </span>{</span><br><span class="line">        setCurrentItemInternal(item, smoothScroll, always, <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCurrentItemInternal</span><span class="params">(<span class="keyword">int</span> item, <span class="keyword">boolean</span> smoothScroll, <span class="keyword">boolean</span> always,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="keyword">int</span> velocity)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mAdapter == <span class="keyword">null</span> || mAdapter.getCount() &lt;= <span class="number">0</span>) {</span><br><span class="line">            setScrollingCacheEnabled(<span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!always &amp;&amp; mCurItem == item &amp;&amp; mItems.size() != <span class="number">0</span>) {</span><br><span class="line">            setScrollingCacheEnabled(<span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (item &lt; <span class="number">0</span>) {</span><br><span class="line">            item = <span class="number">0</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (item &gt;= mAdapter.getCount()) {</span><br><span class="line">            item = mAdapter.getCount() - <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> pageLimit = mOffscreenPageLimit;</span><br><span class="line">        <span class="keyword">if</span> (item &gt; (mCurItem + pageLimit) || item &lt; (mCurItem - pageLimit)) {</span><br><span class="line">            <span class="comment">// We are doing a jump by more than one page. To avoid</span></span><br><span class="line">            <span class="comment">// glitches, we want to keep all current pages in the view</span></span><br><span class="line">            <span class="comment">// until the scroll ends.</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">                mItems.get(i).scrolling = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> dispatchSelected = mCurItem != item;</span><br><span class="line">        mCurItem = item;</span><br><span class="line">        populate();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> destX = (getWidth() + mPageMargin) * item;</span><br><span class="line">        <span class="keyword">if</span> (smoothScroll) {</span><br><span class="line">            smoothScrollTo(destX, <span class="number">0</span>, velocity);</span><br><span class="line">            <span class="keyword">if</span> (dispatchSelected &amp;&amp; mOnPageChangeListener != <span class="keyword">null</span>) {</span><br><span class="line">                mOnPageChangeListener.onPageSelected(item);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">if</span> (dispatchSelected &amp;&amp; mOnPageChangeListener != <span class="keyword">null</span>) {</span><br><span class="line">                mOnPageChangeListener.onPageSelected(item);</span><br><span class="line">            }</span><br><span class="line">            completeScroll();</span><br><span class="line">            scrollTo(destX, <span class="number">0</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnPageChangeListener</span><span class="params">(OnPageChangeListener listener)</span> </span>{</span><br><span class="line">        mOnPageChangeListener = listener;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the number of pages that will be retained to either side of the</span></span><br><span class="line"><span class="comment">     * current page in the view hierarchy in an idle state. Defaults to 1.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> How many pages will be kept offscreen on either side</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setOffscreenPageLimit(int)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOffscreenPageLimit</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mOffscreenPageLimit;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the number of pages that should be retained to either side of the</span></span><br><span class="line"><span class="comment">     * current page in the view hierarchy in an idle state. Pages beyond this</span></span><br><span class="line"><span class="comment">     * limit will be recreated from the adapter when needed.</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * This is offered as an optimization. If you know in advance the number of</span></span><br><span class="line"><span class="comment">     * pages you will need to support or have lazy-loading mechanisms in place</span></span><br><span class="line"><span class="comment">     * on your pages, tweaking this setting can have benefits in perceived</span></span><br><span class="line"><span class="comment">     * smoothness of paging animations and interaction. If you have a small</span></span><br><span class="line"><span class="comment">     * number of pages (3-4) that you can keep active all at once, less time</span></span><br><span class="line"><span class="comment">     * will be spent in layout for newly created view subtrees as the user pages</span></span><br><span class="line"><span class="comment">     * back and forth.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * You should keep this limit low, especially if your pages have complex</span></span><br><span class="line"><span class="comment">     * layouts. This setting defaults to 1.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit How many pages will be kept offscreen in an idle state.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOffscreenPageLimit</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (limit &lt; DEFAULT_OFFSCREEN_PAGES) {</span><br><span class="line">            Log.w(TAG, <span class="string">"Requested offscreen page limit "</span> + limit</span><br><span class="line">                    + <span class="string">" too small; defaulting to "</span> + DEFAULT_OFFSCREEN_PAGES);</span><br><span class="line">            limit = DEFAULT_OFFSCREEN_PAGES;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (limit != mOffscreenPageLimit) {</span><br><span class="line">            mOffscreenPageLimit = limit;</span><br><span class="line">            populate();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the margin between pages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> marginPixels Distance between adjacent pages in pixels</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getPageMargin()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setPageMarginDrawable(Drawable)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setPageMarginDrawable(int)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageMargin</span><span class="params">(<span class="keyword">int</span> marginPixels)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> oldMargin = mPageMargin;</span><br><span class="line">        mPageMargin = marginPixels;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> width = getWidth();</span><br><span class="line">        recomputeScrollPosition(width, width, marginPixels, oldMargin);</span><br><span class="line"></span><br><span class="line">        requestLayout();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the margin between pages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The size of the margin in pixels</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageMargin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mPageMargin;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set a drawable that will be used to fill the margin between pages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> d Drawable to display between pages</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageMarginDrawable</span><span class="params">(Drawable d)</span> </span>{</span><br><span class="line">        mMarginDrawable = d;</span><br><span class="line">        <span class="keyword">if</span> (d != <span class="keyword">null</span>)</span><br><span class="line">            refreshDrawableState();</span><br><span class="line">        setWillNotDraw(d == <span class="keyword">null</span>);</span><br><span class="line">        invalidate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set a drawable that will be used to fill the margin between pages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resId Resource ID of a drawable to display between pages</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageMarginDrawable</span><span class="params">(<span class="keyword">int</span> resId)</span> </span>{</span><br><span class="line">        setPageMarginDrawable(getContext().getResources().getDrawable(resId));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">verifyDrawable</span><span class="params">(Drawable who)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.verifyDrawable(who) || who == mMarginDrawable;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawableStateChanged</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.drawableStateChanged();</span><br><span class="line">        <span class="keyword">final</span> Drawable d = mMarginDrawable;</span><br><span class="line">        <span class="keyword">if</span> (d != <span class="keyword">null</span> &amp;&amp; d.isStateful()) {</span><br><span class="line">            d.setState(getDrawableState());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We want the duration of the page snap animation to be influenced by the</span></span><br><span class="line">    <span class="comment">// distance that</span></span><br><span class="line">    <span class="comment">// the screen has to travel, however, we don't want this duration to be</span></span><br><span class="line">    <span class="comment">// effected in a</span></span><br><span class="line">    <span class="comment">// purely linear fashion. Instead, we use this method to moderate the effect</span></span><br><span class="line">    <span class="comment">// that the distance</span></span><br><span class="line">    <span class="comment">// of travel has on the overall snap duration.</span></span><br><span class="line">    <span class="function"><span class="keyword">float</span> <span class="title">distanceInfluenceForSnapDuration</span><span class="params">(<span class="keyword">float</span> f)</span> </span>{</span><br><span class="line">        f -= <span class="number">0.5f</span>; <span class="comment">// center the values about 0.</span></span><br><span class="line">        f *= <span class="number">0.3f</span> * Math.PI / <span class="number">2.0f</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">float</span>) Math.sin(f);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Like {<span class="doctag">@link</span> View#scrollBy}, but scroll smoothly instead of</span></span><br><span class="line"><span class="comment">     * immediately.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x the number of pixels to scroll by on the X axis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y the number of pixels to scroll by on the Y axis</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">smoothScrollTo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>{</span><br><span class="line">        smoothScrollTo(x, y, <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Like {<span class="doctag">@link</span> View#scrollBy}, but scroll smoothly instead of</span></span><br><span class="line"><span class="comment">     * immediately.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x        the number of pixels to scroll by on the X axis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y        the number of pixels to scroll by on the Y axis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> velocity the velocity associated with a fling, if applicable. (0</span></span><br><span class="line"><span class="comment">     *                 otherwise)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">smoothScrollTo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> velocity)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (getChildCount() == <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// Nothing to do.</span></span><br><span class="line">            setScrollingCacheEnabled(<span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> sx = getScrollX();</span><br><span class="line">        <span class="keyword">int</span> sy = getScrollY();</span><br><span class="line">        <span class="keyword">int</span> dx = x - sx;</span><br><span class="line">        <span class="keyword">int</span> dy = y - sy;</span><br><span class="line">        <span class="keyword">if</span> (dx == <span class="number">0</span> &amp;&amp; dy == <span class="number">0</span>) {</span><br><span class="line">            completeScroll();</span><br><span class="line">            setScrollState(SCROLL_STATE_IDLE);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        setScrollingCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">        mScrolling = <span class="keyword">true</span>;</span><br><span class="line">        setScrollState(SCROLL_STATE_SETTLING);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> pageDelta = (<span class="keyword">float</span>) Math.abs(dx)</span><br><span class="line">                / (getWidth() + mPageMargin);</span><br><span class="line">        <span class="keyword">int</span> duration = (<span class="keyword">int</span>) (pageDelta * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        velocity = Math.abs(velocity);</span><br><span class="line">        <span class="keyword">if</span> (velocity &gt; <span class="number">0</span>) {</span><br><span class="line">            duration += (duration / (velocity / mBaseLineFlingVelocity))</span><br><span class="line">                    * mFlingVelocityInfluence;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            duration += <span class="number">100</span>;</span><br><span class="line">        }</span><br><span class="line">        duration = Math.min(duration, MAX_SETTLE_DURATION);</span><br><span class="line"></span><br><span class="line">        mScroller.startScroll(sx, sy, dx, dy, duration);</span><br><span class="line">        invalidate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addNewItem</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        ItemInfo ii = <span class="keyword">new</span> ItemInfo();</span><br><span class="line">        ii.position = position;</span><br><span class="line">        ii.object = mAdapter.instantiateItem(<span class="keyword">this</span>, position);</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>) {</span><br><span class="line">            mItems.add(ii);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            mItems.add(index, ii);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dataSetChanged</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// This method only gets called if our observer is attached, so mAdapter</span></span><br><span class="line">        <span class="comment">// is non-null.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> needPopulate = mItems.size() &lt; <span class="number">3</span></span><br><span class="line">                &amp;&amp; mItems.size() &lt; mAdapter.getCount();</span><br><span class="line">        <span class="keyword">int</span> newCurrItem = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">            <span class="keyword">final</span> ItemInfo ii = mItems.get(i);</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> newPos = mAdapter.getItemPosition(ii.object);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (newPos == PagerAdapter.POSITION_UNCHANGED) {</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (newPos == PagerAdapter.POSITION_NONE) {</span><br><span class="line">                mItems.remove(i);</span><br><span class="line">                i--;</span><br><span class="line">                mAdapter.destroyItem(<span class="keyword">this</span>, ii.position, ii.object);</span><br><span class="line">                needPopulate = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (mCurItem == ii.position) {</span><br><span class="line">                    <span class="comment">// Keep the current item in the valid range</span></span><br><span class="line">                    newCurrItem = Math.max(<span class="number">0</span>,</span><br><span class="line">                            Math.min(mCurItem, mAdapter.getCount() - <span class="number">1</span>));</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ii.position != newPos) {</span><br><span class="line">                <span class="keyword">if</span> (ii.position == mCurItem) {</span><br><span class="line">                    <span class="comment">// Our current item changed position. Follow it.</span></span><br><span class="line">                    newCurrItem = newPos;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                ii.position = newPos;</span><br><span class="line">                needPopulate = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Collections.sort(mItems, COMPARATOR);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newCurrItem &gt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// TODO This currently causes a jump.</span></span><br><span class="line">            setCurrentItemInternal(newCurrItem, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">            needPopulate = <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (needPopulate) {</span><br><span class="line">            populate();</span><br><span class="line">            requestLayout();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">populate</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mAdapter == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bail now if we are waiting to populate. This is to hold off</span></span><br><span class="line">        <span class="comment">// on creating views from the time the user releases their finger to</span></span><br><span class="line">        <span class="comment">// fling to a new position until we have finished the scroll to</span></span><br><span class="line">        <span class="comment">// that position, avoiding glitches from happening at that point.</span></span><br><span class="line">        <span class="keyword">if</span> (mPopulatePending) {</span><br><span class="line">            <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                Log.i(TAG, <span class="string">"populate is pending, skipping for now..."</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Also, don't populate until we are attached to a window. This is to</span></span><br><span class="line">        <span class="comment">// avoid trying to populate before we have restored our view hierarchy</span></span><br><span class="line">        <span class="comment">// state and conflicting with what is restored.</span></span><br><span class="line">        <span class="keyword">if</span> (getWindowToken() == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        mAdapter.startUpdate(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> pageLimit = mOffscreenPageLimit;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> startPos = Math.max(<span class="number">0</span>, mCurItem - pageLimit);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> N = mAdapter.getCount();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> endPos = Math.min(N - <span class="number">1</span>, mCurItem + pageLimit);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">            Log.v(TAG, <span class="string">"populating: startPos="</span> + startPos + <span class="string">" endPos="</span> + endPos);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add and remove pages in the existing list.</span></span><br><span class="line">        <span class="keyword">int</span> lastPos = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">            ItemInfo ii = mItems.get(i);</span><br><span class="line">            <span class="keyword">if</span> ((ii.position &lt; startPos || ii.position &gt; endPos)</span><br><span class="line">                    &amp;&amp; !ii.scrolling) {</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.i(TAG, <span class="string">"removing: "</span> + ii.position + <span class="string">" @ "</span> + i);</span><br><span class="line">                mItems.remove(i);</span><br><span class="line">                i--;</span><br><span class="line">                mAdapter.destroyItem(<span class="keyword">this</span>, ii.position, ii.object);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (lastPos &lt; endPos &amp;&amp; ii.position &gt; startPos) {</span><br><span class="line">                <span class="comment">// The next item is outside of our range, but we have a gap</span></span><br><span class="line">                <span class="comment">// between it and the last item where we want to have a page</span></span><br><span class="line">                <span class="comment">// shown. Fill in the gap.</span></span><br><span class="line">                lastPos++;</span><br><span class="line">                <span class="keyword">if</span> (lastPos &lt; startPos) {</span><br><span class="line">                    lastPos = startPos;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">while</span> (lastPos &lt;= endPos &amp;&amp; lastPos &lt; ii.position) {</span><br><span class="line">                    <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                        Log.i(TAG, <span class="string">"inserting: "</span> + lastPos + <span class="string">" @ "</span> + i);</span><br><span class="line">                    addNewItem(lastPos, i);</span><br><span class="line">                    lastPos++;</span><br><span class="line">                    i++;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            lastPos = ii.position;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add any new pages we need at the end.</span></span><br><span class="line">        lastPos = mItems.size() &gt; <span class="number">0</span> ? mItems.get(mItems.size() - <span class="number">1</span>).position</span><br><span class="line">                : -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (lastPos &lt; endPos) {</span><br><span class="line">            lastPos++;</span><br><span class="line">            lastPos = lastPos &gt; startPos ? lastPos : startPos;</span><br><span class="line">            <span class="keyword">while</span> (lastPos &lt;= endPos) {</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.i(TAG, <span class="string">"appending: "</span> + lastPos);</span><br><span class="line">                addNewItem(lastPos, -<span class="number">1</span>);</span><br><span class="line">                lastPos++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (DEBUG) {</span><br><span class="line">            Log.i(TAG, <span class="string">"Current page list:"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">                Log.i(TAG, <span class="string">"#"</span> + i + <span class="string">": page "</span> + mItems.get(i).position);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        ItemInfo curItem = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (mItems.get(i).position == mCurItem) {</span><br><span class="line">                curItem = mItems.get(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        mAdapter.setPrimaryItem(<span class="keyword">this</span>, mCurItem,</span><br><span class="line">                curItem != <span class="keyword">null</span> ? curItem.object : <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        mAdapter.finishUpdate(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hasFocus()) {</span><br><span class="line">            View currentFocused = findFocus();</span><br><span class="line">            ItemInfo ii = currentFocused != <span class="keyword">null</span> ? infoForAnyChild(currentFocused)</span><br><span class="line">                    : <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (ii == <span class="keyword">null</span> || ii.position != mCurItem) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) {</span><br><span class="line">                    View child = getChildAt(i);</span><br><span class="line">                    ii = infoForChild(child);</span><br><span class="line">                    <span class="keyword">if</span> (ii != <span class="keyword">null</span> &amp;&amp; ii.position == mCurItem) {</span><br><span class="line">                        <span class="keyword">if</span> (child.requestFocus(FOCUS_FORWARD)) {</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedState</span> <span class="keyword">extends</span> <span class="title">BaseSavedState</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> position;</span><br><span class="line">        Parcelable adapterState;</span><br><span class="line">        ClassLoader loader;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SavedState</span><span class="params">(Parcelable superState)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(superState);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel out, <span class="keyword">int</span> flags)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>.writeToParcel(out, flags);</span><br><span class="line">            out.writeInt(position);</span><br><span class="line">            out.writeParcelable(adapterState, flags);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"FragmentPager.SavedState{"</span></span><br><span class="line">                    + Integer.toHexString(System.identityHashCode(<span class="keyword">this</span>))</span><br><span class="line">                    + <span class="string">" position="</span> + position + <span class="string">"}"</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;SavedState&gt; CREATOR = ParcelableCompat</span><br><span class="line">                .newCreator(<span class="keyword">new</span> ParcelableCompatCreatorCallbacks&lt;SavedState&gt;() {</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> SavedState <span class="title">createFromParcel</span><span class="params">(Parcel in,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                       ClassLoader loader)</span> </span>{</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> SavedState(in, loader);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> SavedState[] newArray(<span class="keyword">int</span> size) {</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> SavedState[size];</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line"></span><br><span class="line">        SavedState(Parcel in, ClassLoader loader) {</span><br><span class="line">            <span class="keyword">super</span>(in);</span><br><span class="line">            <span class="keyword">if</span> (loader == <span class="keyword">null</span>) {</span><br><span class="line">                loader = getClass().getClassLoader();</span><br><span class="line">            }</span><br><span class="line">            position = in.readInt();</span><br><span class="line">            adapterState = in.readParcelable(loader);</span><br><span class="line">            <span class="keyword">this</span>.loader = loader;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Parcelable <span class="title">onSaveInstanceState</span><span class="params">()</span> </span>{</span><br><span class="line">        Parcelable superState = <span class="keyword">super</span>.onSaveInstanceState();</span><br><span class="line">        SavedState ss = <span class="keyword">new</span> SavedState(superState);</span><br><span class="line">        ss.position = mCurItem;</span><br><span class="line">        <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span>) {</span><br><span class="line">            ss.adapterState = mAdapter.saveState();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ss;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Parcelable state)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!(state <span class="keyword">instanceof</span> SavedState)) {</span><br><span class="line">            <span class="keyword">super</span>.onRestoreInstanceState(state);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        SavedState ss = (SavedState) state;</span><br><span class="line">        <span class="keyword">super</span>.onRestoreInstanceState(ss.getSuperState());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span>) {</span><br><span class="line">            mAdapter.restoreState(ss.adapterState, ss.loader);</span><br><span class="line">            setCurrentItemInternal(ss.position, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            mRestoredCurItem = ss.position;</span><br><span class="line">            mRestoredAdapterState = ss.adapterState;</span><br><span class="line">            mRestoredClassLoader = ss.loader;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addView</span><span class="params">(View child, <span class="keyword">int</span> index, LayoutParams params)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mInLayout) {</span><br><span class="line">            addViewInLayout(child, index, params);</span><br><span class="line">            child.measure(mChildWidthMeasureSpec, mChildHeightMeasureSpec);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">super</span>.addView(child, index, params);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (USE_CACHE) {</span><br><span class="line">            <span class="keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                child.setDrawingCacheEnabled(mScrollingCacheEnabled);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                child.setDrawingCacheEnabled(<span class="keyword">false</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function">ItemInfo <span class="title">infoForChild</span><span class="params">(View child)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">            ItemInfo ii = mItems.get(i);</span><br><span class="line">            <span class="keyword">if</span> (mAdapter.isViewFromObject(child, ii.object)) {</span><br><span class="line">                <span class="keyword">return</span> ii;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function">ItemInfo <span class="title">infoForAnyChild</span><span class="params">(View child)</span> </span>{</span><br><span class="line">        ViewParent parent;</span><br><span class="line">        <span class="keyword">while</span> ((parent = child.getParent()) != <span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">if</span> (parent == <span class="keyword">null</span> || !(parent <span class="keyword">instanceof</span> View)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">            child = (View) parent;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> infoForChild(child);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow();</span><br><span class="line">        mFirstLayout = <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">        <span class="comment">// For simple implementation, or internal size is always 0.</span></span><br><span class="line">        <span class="comment">// We depend on the container to specify the layout size of</span></span><br><span class="line">        <span class="comment">// our view. We can't really know what it is since we will be</span></span><br><span class="line">        <span class="comment">// adding and removing different arbitrary views and do not</span></span><br><span class="line">        <span class="comment">// want the layout to change as this happens.</span></span><br><span class="line">        setMeasuredDimension(getDefaultSize(<span class="number">0</span>, widthMeasureSpec),</span><br><span class="line">                getDefaultSize(<span class="number">0</span>, heightMeasureSpec));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Children are just made to fill our space.</span></span><br><span class="line">        mChildWidthMeasureSpec = MeasureSpec.makeMeasureSpec(getMeasuredWidth()</span><br><span class="line">                - getPaddingLeft() - getPaddingRight(), MeasureSpec.EXACTLY);</span><br><span class="line">        mChildHeightMeasureSpec = MeasureSpec.makeMeasureSpec(</span><br><span class="line">                getMeasuredHeight() - getPaddingTop() - getPaddingBottom(),</span><br><span class="line">                MeasureSpec.EXACTLY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure we have created all fragments that we need to have shown.</span></span><br><span class="line">        mInLayout = <span class="keyword">true</span>;</span><br><span class="line">        populate();</span><br><span class="line">        mInLayout = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure all children have been properly measured.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> size = getChildCount();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; ++i) {</span><br><span class="line">            <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.v(TAG, <span class="string">"Measuring #"</span> + i + <span class="string">" "</span> + child + <span class="string">": "</span></span><br><span class="line">                            + mChildWidthMeasureSpec);</span><br><span class="line">                child.measure(mChildWidthMeasureSpec, mChildHeightMeasureSpec);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSizeChanged</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> oldw, <span class="keyword">int</span> oldh)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure scroll position is set correctly.</span></span><br><span class="line">        <span class="keyword">if</span> (w != oldw) {</span><br><span class="line">            recomputeScrollPosition(w, oldw, mPageMargin, mPageMargin);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recomputeScrollPosition</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> oldWidth, <span class="keyword">int</span> margin,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         <span class="keyword">int</span> oldMargin)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> widthWithMargin = width + margin;</span><br><span class="line">        <span class="keyword">if</span> (oldWidth &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> oldScrollPos = getScrollX();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> oldwwm = oldWidth + oldMargin;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> oldScrollItem = oldScrollPos / oldwwm;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> scrollOffset = (<span class="keyword">float</span>) (oldScrollPos % oldwwm) / oldwwm;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> scrollPos = (<span class="keyword">int</span>) ((oldScrollItem + scrollOffset) * widthWithMargin);</span><br><span class="line">            scrollTo(scrollPos, getScrollY());</span><br><span class="line">            <span class="keyword">if</span> (!mScroller.isFinished()) {</span><br><span class="line">                <span class="comment">// We now return to your regularly scheduled scroll, already in</span></span><br><span class="line">                <span class="comment">// progress.</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> newDuration = mScroller.getDuration()</span><br><span class="line">                        - mScroller.timePassed();</span><br><span class="line">                mScroller.startScroll(scrollPos, <span class="number">0</span>, mCurItem * widthWithMargin,</span><br><span class="line">                        <span class="number">0</span>, newDuration);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">int</span> scrollPos = mCurItem * widthWithMargin;</span><br><span class="line">            <span class="keyword">if</span> (scrollPos != getScrollX()) {</span><br><span class="line">                completeScroll();</span><br><span class="line">                scrollTo(scrollPos, getScrollY());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">        mInLayout = <span class="keyword">true</span>;</span><br><span class="line">        populate();</span><br><span class="line">        mInLayout = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> count = getChildCount();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> width = r - l;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            ItemInfo ii;</span><br><span class="line">            <span class="keyword">if</span> (child.getVisibility() != GONE</span><br><span class="line">                    &amp;&amp; (ii = infoForChild(child)) != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">int</span> loff = (width + mPageMargin) * ii.position;</span><br><span class="line">                <span class="keyword">int</span> childLeft = getPaddingLeft() + loff;</span><br><span class="line">                <span class="keyword">int</span> childTop = getPaddingTop();</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.v(TAG,</span><br><span class="line">                            <span class="string">"Positioning #"</span> + i + <span class="string">" "</span> + child + <span class="string">" f="</span></span><br><span class="line">                                    + ii.object + <span class="string">":"</span> + childLeft + <span class="string">","</span></span><br><span class="line">                                    + childTop + <span class="string">" "</span> + child.getMeasuredWidth()</span><br><span class="line">                                    + <span class="string">"x"</span> + child.getMeasuredHeight());</span><br><span class="line">                child.layout(childLeft, childTop,</span><br><span class="line">                        childLeft + child.getMeasuredWidth(),</span><br><span class="line">                        childTop + child.getMeasuredHeight());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        mFirstLayout = <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">            Log.i(TAG, <span class="string">"computeScroll: finished="</span> + mScroller.isFinished());</span><br><span class="line">        <span class="keyword">if</span> (!mScroller.isFinished()) {</span><br><span class="line">            <span class="keyword">if</span> (mScroller.computeScrollOffset()) {</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.i(TAG, <span class="string">"computeScroll: still scrolling"</span>);</span><br><span class="line">                <span class="keyword">int</span> oldX = getScrollX();</span><br><span class="line">                <span class="keyword">int</span> oldY = getScrollY();</span><br><span class="line">                <span class="keyword">int</span> x = mScroller.getCurrX();</span><br><span class="line">                <span class="keyword">int</span> y = mScroller.getCurrY();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (oldX != x || oldY != y) {</span><br><span class="line">                    scrollTo(x, y);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (mOnPageChangeListener != <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> widthWithMargin = getWidth() + mPageMargin;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> position = x / widthWithMargin;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> offsetPixels = x % widthWithMargin;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> offset = (<span class="keyword">float</span>) offsetPixels / widthWithMargin;</span><br><span class="line">                    mOnPageChangeListener.onPageScrolled(position, offset,</span><br><span class="line">                            offsetPixels);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Keep on drawing until the animation has finished.</span></span><br><span class="line">                invalidate();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Done with scroll, clean up state.</span></span><br><span class="line">        completeScroll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">completeScroll</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">boolean</span> needPopulate = mScrolling;</span><br><span class="line">        <span class="keyword">if</span> (needPopulate) {</span><br><span class="line">            <span class="comment">// Done with scroll, no longer want to cache view drawing.</span></span><br><span class="line">            setScrollingCacheEnabled(<span class="keyword">false</span>);</span><br><span class="line">            mScroller.abortAnimation();</span><br><span class="line">            <span class="keyword">int</span> oldX = getScrollX();</span><br><span class="line">            <span class="keyword">int</span> oldY = getScrollY();</span><br><span class="line">            <span class="keyword">int</span> x = mScroller.getCurrX();</span><br><span class="line">            <span class="keyword">int</span> y = mScroller.getCurrY();</span><br><span class="line">            <span class="keyword">if</span> (oldX != x || oldY != y) {</span><br><span class="line">                scrollTo(x, y);</span><br><span class="line">            }</span><br><span class="line">            setScrollState(SCROLL_STATE_IDLE);</span><br><span class="line">        }</span><br><span class="line">        mPopulatePending = <span class="keyword">false</span>;</span><br><span class="line">        mScrolling = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">            ItemInfo ii = mItems.get(i);</span><br><span class="line">            <span class="keyword">if</span> (ii.scrolling) {</span><br><span class="line">                needPopulate = <span class="keyword">true</span>;</span><br><span class="line">                ii.scrolling = <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (needPopulate) {</span><br><span class="line">            populate();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * This method JUST determines whether we want to intercept the motion.</span></span><br><span class="line"><span class="comment">     * If we return true, onMotionEvent will be called and we do the actual</span></span><br><span class="line"><span class="comment">     * scrolling there.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction() &amp; MotionEventCompat.ACTION_MASK;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Always take care of the touch gesture being complete.</span></span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_CANCEL</span><br><span class="line">                || action == MotionEvent.ACTION_UP) {</span><br><span class="line">            <span class="comment">// Release the drag.</span></span><br><span class="line">            <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                Log.v(TAG, <span class="string">"Intercept done!"</span>);</span><br><span class="line">            mIsBeingDragged = <span class="keyword">false</span>;</span><br><span class="line">            mIsUnableToDrag = <span class="keyword">false</span>;</span><br><span class="line">            mActivePointerId = INVALID_POINTER;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Nothing more to do here if we have decided whether or not we</span></span><br><span class="line">        <span class="comment">// are dragging.</span></span><br><span class="line">        <span class="keyword">if</span> (action != MotionEvent.ACTION_DOWN) {</span><br><span class="line">            <span class="keyword">if</span> (mIsBeingDragged) {</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.v(TAG, <span class="string">"Intercept returning true!"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (mIsUnableToDrag) {</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.v(TAG, <span class="string">"Intercept returning false!"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (action) {</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE: {</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * mIsBeingDragged == false, otherwise the shortcut would have</span></span><br><span class="line"><span class="comment">       * caught it. Check whether the user has moved far enough from his</span></span><br><span class="line"><span class="comment">       * original down touch.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * Locally do absolute value. mLastMotionY is set to the y value of</span></span><br><span class="line"><span class="comment">       * the down event.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> activePointerId = mActivePointerId;</span><br><span class="line">                <span class="keyword">if</span> (activePointerId == INVALID_POINTER) {</span><br><span class="line">                    <span class="comment">// If we don't have a valid id, the touch down wasn't on</span></span><br><span class="line">                    <span class="comment">// content.</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> pointerIndex = MotionEventCompat.findPointerIndex(ev,</span><br><span class="line">                        activePointerId);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">float</span> x = MotionEventCompat.getX(ev, pointerIndex);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">float</span> dx = x - mLastMotionX;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">float</span> xDiff = Math.abs(dx);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">float</span> y = MotionEventCompat.getY(ev, pointerIndex);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">float</span> yDiff = Math.abs(y - mLastMotionY);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> scrollX = getScrollX();</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">boolean</span> atEdge = (dx &gt; <span class="number">0</span> &amp;&amp; scrollX == <span class="number">0</span>)</span><br><span class="line">                        || (dx &lt; <span class="number">0</span> &amp;&amp; mAdapter != <span class="keyword">null</span> &amp;&amp; scrollX &gt;= (mAdapter</span><br><span class="line">                        .getCount() - <span class="number">1</span>) * getWidth() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.v(TAG, <span class="string">"Moved x to "</span> + x + <span class="string">","</span> + y + <span class="string">" diff="</span> + xDiff + <span class="string">","</span></span><br><span class="line">                            + yDiff);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (canScroll(<span class="keyword">this</span>, <span class="keyword">false</span>, (<span class="keyword">int</span>) dx, (<span class="keyword">int</span>) x, (<span class="keyword">int</span>) y)) {</span><br><span class="line">                    <span class="comment">// Nested view has scrollable area under this point. Let it be</span></span><br><span class="line">                    <span class="comment">// handled there.</span></span><br><span class="line">                    mInitialMotionX = mLastMotionX = x;</span><br><span class="line">                    mLastMotionY = y;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (xDiff &gt; mTouchSlop &amp;&amp; xDiff &gt; yDiff) {</span><br><span class="line">                    <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                        Log.v(TAG, <span class="string">"Starting drag!"</span>);</span><br><span class="line">                    mIsBeingDragged = <span class="keyword">true</span>;</span><br><span class="line">                    setScrollState(SCROLL_STATE_DRAGGING);</span><br><span class="line">                    mLastMotionX = x;</span><br><span class="line">                    setScrollingCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">if</span> (yDiff &gt; mTouchSlop) {</span><br><span class="line">                        <span class="comment">// The finger has moved enough in the vertical</span></span><br><span class="line">                        <span class="comment">// direction to be counted as a drag... abort</span></span><br><span class="line">                        <span class="comment">// any attempt to drag horizontally, to work correctly</span></span><br><span class="line">                        <span class="comment">// with children that have scrolling containers.</span></span><br><span class="line">                        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                            Log.v(TAG, <span class="string">"Starting unable to drag!"</span>);</span><br><span class="line">                        mIsUnableToDrag = <span class="keyword">true</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN: {</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * Remember location of down touch. ACTION_DOWN always refers to</span></span><br><span class="line"><span class="comment">       * pointer index 0.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">                mLastMotionX = mInitialMotionX = ev.getX();</span><br><span class="line">                mLastMotionY = ev.getY();</span><br><span class="line">                mActivePointerId = MotionEventCompat.getPointerId(ev, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (mScrollState == SCROLL_STATE_SETTLING) {</span><br><span class="line">                    <span class="comment">// Let the user 'catch' the pager as it animates.</span></span><br><span class="line">                    mIsBeingDragged = <span class="keyword">true</span>;</span><br><span class="line">                    mIsUnableToDrag = <span class="keyword">false</span>;</span><br><span class="line">                    setScrollState(SCROLL_STATE_DRAGGING);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    completeScroll();</span><br><span class="line">                    mIsBeingDragged = <span class="keyword">false</span>;</span><br><span class="line">                    mIsUnableToDrag = <span class="keyword">false</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                    Log.v(TAG, <span class="string">"Down at "</span> + mLastMotionX + <span class="string">","</span> + mLastMotionY</span><br><span class="line">                            + <span class="string">" mIsBeingDragged="</span> + mIsBeingDragged</span><br><span class="line">                            + <span class="string">"mIsUnableToDrag="</span> + mIsUnableToDrag);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> MotionEventCompat.ACTION_POINTER_UP:</span><br><span class="line">                onSecondaryPointerUp(ev);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * The only time we want to intercept motion events is if we are in the</span></span><br><span class="line"><span class="comment">     * drag mode.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">        <span class="keyword">return</span> mIsBeingDragged;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mFakeDragging) {</span><br><span class="line">            <span class="comment">// A fake drag is in progress already, ignore this real one</span></span><br><span class="line">            <span class="comment">// but still eat the touch events.</span></span><br><span class="line">            <span class="comment">// (It is likely that the user is multi-touching the screen.)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN &amp;&amp; ev.getEdgeFlags() != <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// Don't handle edge touches immediately -- they may actually belong</span></span><br><span class="line">            <span class="comment">// to one of our</span></span><br><span class="line">            <span class="comment">// descendants.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mAdapter == <span class="keyword">null</span> || mAdapter.getCount() == <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// Nothing to present or scroll; nothing to touch.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mVelocityTracker == <span class="keyword">null</span>) {</span><br><span class="line">            mVelocityTracker = VelocityTracker.obtain();</span><br><span class="line">        }</span><br><span class="line">        mVelocityTracker.addMovement(ev);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">        <span class="keyword">boolean</span> needsInvalidate = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (action &amp; MotionEventCompat.ACTION_MASK) {</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN: {</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * If being flinged and user touches, stop the fling. isFinished</span></span><br><span class="line"><span class="comment">       * will be false if being flinged.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">                completeScroll();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Remember where the motion event started</span></span><br><span class="line">                mLastMotionX = mInitialMotionX = ev.getX();</span><br><span class="line">                mActivePointerId = MotionEventCompat.getPointerId(ev, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="keyword">if</span> (!mIsBeingDragged) {</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> pointerIndex = MotionEventCompat.findPointerIndex(ev,</span><br><span class="line">                            mActivePointerId);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> x = MotionEventCompat.getX(ev, pointerIndex);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> xDiff = Math.abs(x - mLastMotionX);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> y = MotionEventCompat.getY(ev, pointerIndex);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> yDiff = Math.abs(y - mLastMotionY);</span><br><span class="line">                    <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                        Log.v(TAG, <span class="string">"Moved x to "</span> + x + <span class="string">","</span> + y + <span class="string">" diff="</span> + xDiff</span><br><span class="line">                                + <span class="string">","</span> + yDiff);</span><br><span class="line">                    <span class="keyword">if</span> (xDiff &gt; mTouchSlop &amp;&amp; xDiff &gt; yDiff) {</span><br><span class="line">                        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">                            Log.v(TAG, <span class="string">"Starting drag!"</span>);</span><br><span class="line">                        mIsBeingDragged = <span class="keyword">true</span>;</span><br><span class="line">                        mLastMotionX = x;</span><br><span class="line">                        setScrollState(SCROLL_STATE_DRAGGING);</span><br><span class="line">                        setScrollingCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (mIsBeingDragged) {</span><br><span class="line">                    <span class="comment">// Scroll to follow the motion event</span></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> activePointerIndex = MotionEventCompat</span><br><span class="line">                            .findPointerIndex(ev, mActivePointerId);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> x = MotionEventCompat.getX(ev, activePointerIndex);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> deltaX = mLastMotionX - x;</span><br><span class="line">                    mLastMotionX = x;</span><br><span class="line">                    <span class="keyword">float</span> oldScrollX = getScrollX();</span><br><span class="line">                    <span class="keyword">float</span> scrollX = oldScrollX + deltaX;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> width = getWidth();</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> widthWithMargin = width + mPageMargin;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> lastItemIndex = mAdapter.getCount() - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> leftBound = Math.max(<span class="number">0</span>, (mCurItem - <span class="number">1</span>)</span><br><span class="line">                            * widthWithMargin);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> rightBound = Math.min(mCurItem + <span class="number">1</span>, lastItemIndex)</span><br><span class="line">                            * widthWithMargin;</span><br><span class="line">                    <span class="keyword">if</span> (scrollX &lt; leftBound) {</span><br><span class="line">                        <span class="keyword">if</span> (leftBound == <span class="number">0</span>) {</span><br><span class="line">                            <span class="keyword">float</span> over = -scrollX;</span><br><span class="line">                            needsInvalidate = mLeftEdge.onPull(over / width);</span><br><span class="line">                        }</span><br><span class="line">                        scrollX = leftBound;</span><br><span class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (scrollX &gt; rightBound) {</span><br><span class="line">                        <span class="keyword">if</span> (rightBound == lastItemIndex * widthWithMargin) {</span><br><span class="line">                            <span class="keyword">float</span> over = scrollX - rightBound;</span><br><span class="line">                            needsInvalidate = mRightEdge.onPull(over / width);</span><br><span class="line">                        }</span><br><span class="line">                        scrollX = rightBound;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">// Don't lose the rounded component</span></span><br><span class="line">                    mLastMotionX += scrollX - (<span class="keyword">int</span>) scrollX;</span><br><span class="line">                    scrollTo((<span class="keyword">int</span>) scrollX, getScrollY());</span><br><span class="line">                    <span class="keyword">if</span> (mOnPageChangeListener != <span class="keyword">null</span>) {</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">int</span> position = (<span class="keyword">int</span>) scrollX / widthWithMargin;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">int</span> positionOffsetPixels = (<span class="keyword">int</span>) scrollX</span><br><span class="line">                                % widthWithMargin;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">float</span> positionOffset = (<span class="keyword">float</span>) positionOffsetPixels</span><br><span class="line">                                / widthWithMargin;</span><br><span class="line">                        mOnPageChangeListener.onPageScrolled(position,</span><br><span class="line">                                positionOffset, positionOffsetPixels);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                <span class="keyword">if</span> (mIsBeingDragged) {</span><br><span class="line">                    <span class="keyword">final</span> VelocityTracker velocityTracker = mVelocityTracker;</span><br><span class="line">                    velocityTracker.computeCurrentVelocity(<span class="number">1000</span>, mMaximumVelocity);</span><br><span class="line">                    <span class="keyword">int</span> initialVelocity = (<span class="keyword">int</span>) VelocityTrackerCompat.getXVelocity(</span><br><span class="line">                            velocityTracker, mActivePointerId);</span><br><span class="line">                    mPopulatePending = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> widthWithMargin = getWidth() + mPageMargin;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> scrollX = getScrollX();</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> currentPage = scrollX / widthWithMargin;</span><br><span class="line">                    <span class="keyword">int</span> nextPage = initialVelocity &gt; <span class="number">0</span> ? currentPage</span><br><span class="line">                            : currentPage + <span class="number">1</span>;</span><br><span class="line">                    setCurrentItemInternal(nextPage, <span class="keyword">true</span>, <span class="keyword">true</span>, initialVelocity);</span><br><span class="line"></span><br><span class="line">                    mActivePointerId = INVALID_POINTER;</span><br><span class="line">                    endDrag();</span><br><span class="line">                    needsInvalidate = mLeftEdge.onRelease()</span><br><span class="line">                            | mRightEdge.onRelease();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</span><br><span class="line">                <span class="keyword">if</span> (mIsBeingDragged) {</span><br><span class="line">                    setCurrentItemInternal(mCurItem, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">                    mActivePointerId = INVALID_POINTER;</span><br><span class="line">                    endDrag();</span><br><span class="line">                    needsInvalidate = mLeftEdge.onRelease()</span><br><span class="line">                            | mRightEdge.onRelease();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEventCompat.ACTION_POINTER_DOWN: {</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> index = MotionEventCompat.getActionIndex(ev);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">float</span> x = MotionEventCompat.getX(ev, index);</span><br><span class="line">                mLastMotionX = x;</span><br><span class="line">                mActivePointerId = MotionEventCompat.getPointerId(ev, index);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">case</span> MotionEventCompat.ACTION_POINTER_UP:</span><br><span class="line">                onSecondaryPointerUp(ev);</span><br><span class="line">                mLastMotionX = MotionEventCompat.getX(ev,</span><br><span class="line">                        MotionEventCompat.findPointerIndex(ev, mActivePointerId));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (needsInvalidate) {</span><br><span class="line">            invalidate();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">        <span class="keyword">boolean</span> needsInvalidate = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> overScrollMode = ViewCompat.getOverScrollMode(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (overScrollMode == ViewCompat.OVER_SCROLL_ALWAYS</span><br><span class="line">                || (overScrollMode == ViewCompat.OVER_SCROLL_IF_CONTENT_SCROLLS</span><br><span class="line">                &amp;&amp; mAdapter != <span class="keyword">null</span> &amp;&amp; mAdapter.getCount() &gt; <span class="number">1</span>)) {</span><br><span class="line">            <span class="keyword">if</span> (!mLeftEdge.isFinished()) {</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> restoreCount = canvas.save();</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> height = getHeight() - getPaddingTop()</span><br><span class="line">                        - getPaddingBottom();</span><br><span class="line"></span><br><span class="line">                canvas.rotate(<span class="number">270</span>);</span><br><span class="line">                canvas.translate(-height + getPaddingTop(), <span class="number">0</span>);</span><br><span class="line">                mLeftEdge.setSize(height, getWidth());</span><br><span class="line">                needsInvalidate |= mLeftEdge.draw(canvas);</span><br><span class="line">                canvas.restoreToCount(restoreCount);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!mRightEdge.isFinished()) {</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> restoreCount = canvas.save();</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> width = getWidth();</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> height = getHeight() - getPaddingTop()</span><br><span class="line">                        - getPaddingBottom();</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> itemCount = mAdapter != <span class="keyword">null</span> ? mAdapter.getCount()</span><br><span class="line">                        : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                canvas.rotate(<span class="number">90</span>);</span><br><span class="line">                canvas.translate(-getPaddingTop(), -itemCount</span><br><span class="line">                        * (width + mPageMargin) + mPageMargin);</span><br><span class="line">                mRightEdge.setSize(height, width);</span><br><span class="line">                needsInvalidate |= mRightEdge.draw(canvas);</span><br><span class="line">                canvas.restoreToCount(restoreCount);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            mLeftEdge.finish();</span><br><span class="line">            mRightEdge.finish();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (needsInvalidate) {</span><br><span class="line">            <span class="comment">// Keep animating</span></span><br><span class="line">            invalidate();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Draw the margin drawable if needed.</span></span><br><span class="line">        <span class="keyword">if</span> (mPageMargin &gt; <span class="number">0</span> &amp;&amp; mMarginDrawable != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> scrollX = getScrollX();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> width = getWidth();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> offset = scrollX % (width + mPageMargin);</span><br><span class="line">            <span class="keyword">if</span> (offset != <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// Pages fit completely when settled; we only need to draw when</span></span><br><span class="line">                <span class="comment">// in between</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> left = scrollX - offset + width;</span><br><span class="line">                mMarginDrawable.setBounds(left, <span class="number">0</span>, left + mPageMargin,</span><br><span class="line">                        getHeight());</span><br><span class="line">                mMarginDrawable.draw(canvas);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Start a fake drag of the pager.</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * A fake drag can be useful if you want to synchronize the motion of the</span></span><br><span class="line"><span class="comment">     * ViewPager with the touch scrolling of another view, while still letting</span></span><br><span class="line"><span class="comment">     * the ViewPager control the snapping motion and fling behavior. (e.g.</span></span><br><span class="line"><span class="comment">     * parallax-scrolling tabs.) Call {<span class="doctag">@link</span> #fakeDragBy(float)} to simulate the</span></span><br><span class="line"><span class="comment">     * actual drag motion. Call {<span class="doctag">@link</span> #endFakeDrag()} to complete the fake drag</span></span><br><span class="line"><span class="comment">     * and fling as necessary.</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * During a fake drag the ViewPager will ignore all touch events. If a real</span></span><br><span class="line"><span class="comment">     * drag is already in progress, this method will return false.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if the fake drag began successfully, false if it could not</span></span><br><span class="line"><span class="comment">     * be started.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #fakeDragBy(float)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #endFakeDrag()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">beginFakeDrag</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mIsBeingDragged) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        mFakeDragging = <span class="keyword">true</span>;</span><br><span class="line">        setScrollState(SCROLL_STATE_DRAGGING);</span><br><span class="line">        mInitialMotionX = mLastMotionX = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (mVelocityTracker == <span class="keyword">null</span>) {</span><br><span class="line">            mVelocityTracker = VelocityTracker.obtain();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            mVelocityTracker.clear();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> time = SystemClock.uptimeMillis();</span><br><span class="line">        <span class="keyword">final</span> MotionEvent ev = MotionEvent.obtain(time, time,</span><br><span class="line">                MotionEvent.ACTION_DOWN, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        mVelocityTracker.addMovement(ev);</span><br><span class="line">        ev.recycle();</span><br><span class="line">        mFakeDragBeginTime = time;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * End a fake drag of the pager.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #beginFakeDrag()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #fakeDragBy(float)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endFakeDrag</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!mFakeDragging) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    <span class="string">"No fake drag in progress. Call beginFakeDrag first."</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> VelocityTracker velocityTracker = mVelocityTracker;</span><br><span class="line">        velocityTracker.computeCurrentVelocity(<span class="number">1000</span>, mMaximumVelocity);</span><br><span class="line">        <span class="keyword">int</span> initialVelocity = (<span class="keyword">int</span>) VelocityTrackerCompat.getYVelocity(</span><br><span class="line">                velocityTracker, mActivePointerId);</span><br><span class="line">        mPopulatePending = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> ((Math.abs(initialVelocity) &gt; mMinimumVelocity)</span><br><span class="line">                || Math.abs(mInitialMotionX - mLastMotionX) &gt;= (getWidth() / <span class="number">3</span>)) {</span><br><span class="line">            <span class="keyword">if</span> (mLastMotionX &gt; mInitialMotionX) {</span><br><span class="line">                setCurrentItemInternal(mCurItem - <span class="number">1</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                setCurrentItemInternal(mCurItem + <span class="number">1</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            setCurrentItemInternal(mCurItem, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">        }</span><br><span class="line">        endDrag();</span><br><span class="line"></span><br><span class="line">        mFakeDragging = <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Fake drag by an offset in pixels. You must have called</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> #beginFakeDrag()} first.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> xOffset Offset in pixels to drag by.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #beginFakeDrag()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #endFakeDrag()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fakeDragBy</span><span class="params">(<span class="keyword">float</span> xOffset)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!mFakeDragging) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    <span class="string">"No fake drag in progress. Call beginFakeDrag first."</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        mLastMotionX += xOffset;</span><br><span class="line">        <span class="keyword">float</span> scrollX = getScrollX() - xOffset;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> width = getWidth();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> widthWithMargin = width + mPageMargin;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> leftBound = Math.max(<span class="number">0</span>, (mCurItem - <span class="number">1</span>) * widthWithMargin);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> rightBound = Math</span><br><span class="line">                .min(mCurItem + <span class="number">1</span>, mAdapter.getCount() - <span class="number">1</span>) * widthWithMargin;</span><br><span class="line">        <span class="keyword">if</span> (scrollX &lt; leftBound) {</span><br><span class="line">            scrollX = leftBound;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (scrollX &gt; rightBound) {</span><br><span class="line">            scrollX = rightBound;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// Don't lose the rounded component</span></span><br><span class="line">        mLastMotionX += scrollX - (<span class="keyword">int</span>) scrollX;</span><br><span class="line">        scrollTo((<span class="keyword">int</span>) scrollX, getScrollY());</span><br><span class="line">        <span class="keyword">if</span> (mOnPageChangeListener != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> position = (<span class="keyword">int</span>) scrollX / widthWithMargin;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> positionOffsetPixels = (<span class="keyword">int</span>) scrollX % widthWithMargin;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> positionOffset = (<span class="keyword">float</span>) positionOffsetPixels</span><br><span class="line">                    / widthWithMargin;</span><br><span class="line">            mOnPageChangeListener.onPageScrolled(position, positionOffset,</span><br><span class="line">                    positionOffsetPixels);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Synthesize an event for the VelocityTracker.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> time = SystemClock.uptimeMillis();</span><br><span class="line">        <span class="keyword">final</span> MotionEvent ev = MotionEvent.obtain(mFakeDragBeginTime, time,</span><br><span class="line">                MotionEvent.ACTION_MOVE, mLastMotionX, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        mVelocityTracker.addMovement(ev);</span><br><span class="line">        ev.recycle();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if a fake drag is in progress.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if currently in a fake drag, false otherwise.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #beginFakeDrag()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #fakeDragBy(float)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #endFakeDrag()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFakeDragging</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mFakeDragging;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onSecondaryPointerUp</span><span class="params">(MotionEvent ev)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> pointerIndex = MotionEventCompat.getActionIndex(ev);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> pointerId = MotionEventCompat.getPointerId(ev, pointerIndex);</span><br><span class="line">        <span class="keyword">if</span> (pointerId == mActivePointerId) {</span><br><span class="line">            <span class="comment">// This was our active pointer going up. Choose a new</span></span><br><span class="line">            <span class="comment">// active pointer and adjust accordingly.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> newPointerIndex = pointerIndex == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            mLastMotionX = MotionEventCompat.getX(ev, newPointerIndex);</span><br><span class="line">            mActivePointerId = MotionEventCompat.getPointerId(ev,</span><br><span class="line">                    newPointerIndex);</span><br><span class="line">            <span class="keyword">if</span> (mVelocityTracker != <span class="keyword">null</span>) {</span><br><span class="line">                mVelocityTracker.clear();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">endDrag</span><span class="params">()</span> </span>{</span><br><span class="line">        mIsBeingDragged = <span class="keyword">false</span>;</span><br><span class="line">        mIsUnableToDrag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mVelocityTracker != <span class="keyword">null</span>) {</span><br><span class="line">            mVelocityTracker.recycle();</span><br><span class="line">            mVelocityTracker = <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setScrollingCacheEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mScrollingCacheEnabled != enabled) {</span><br><span class="line">            mScrollingCacheEnabled = enabled;</span><br><span class="line">            <span class="keyword">if</span> (USE_CACHE) {</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> size = getChildCount();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; ++i) {</span><br><span class="line">                    <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">                    <span class="keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                        child.setDrawingCacheEnabled(enabled);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Tests scrollability within child views of v given a delta of dx.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v      View to test for horizontal scrollability</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkV Whether the view v passed should itself be checked for</span></span><br><span class="line"><span class="comment">     *               scrollability (true), or just its children (false).</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dx     Delta scrolled in pixels</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x      X coordinate of the active touch point</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y      Y coordinate of the active touch point</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if child views of v can be scrolled by delta of dx.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">canScroll</span><span class="params">(View v, <span class="keyword">boolean</span> checkV, <span class="keyword">int</span> dx, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (v <span class="keyword">instanceof</span> ViewGroup) {</span><br><span class="line">            <span class="keyword">final</span> ViewGroup group = (ViewGroup) v;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> scrollX = v.getScrollX();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> scrollY = v.getScrollY();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> count = group.getChildCount();</span><br><span class="line">            <span class="comment">// Count backwards - let topmost views consume scroll distance</span></span><br><span class="line">            <span class="comment">// first.</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> Add versioned support here for transformed views.</span></span><br><span class="line">                <span class="comment">// This will not work for transformed views in Honeycomb+</span></span><br><span class="line">                <span class="keyword">final</span> View child = group.getChildAt(i);</span><br><span class="line">                <span class="keyword">if</span> (x + scrollX &gt;= child.getLeft()</span><br><span class="line">                        &amp;&amp; x + scrollX &lt; child.getRight()</span><br><span class="line">                        &amp;&amp; y + scrollY &gt;= child.getTop()</span><br><span class="line">                        &amp;&amp; y + scrollY &lt; child.getBottom()</span><br><span class="line">                        &amp;&amp; canScroll(child, <span class="keyword">true</span>, dx,</span><br><span class="line">                        x + scrollX - child.getLeft(), y + scrollY</span><br><span class="line">                                - child.getTop())) {</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> checkV &amp;&amp; ViewCompat.canScrollHorizontally(v, -dx);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchKeyEvent</span><span class="params">(KeyEvent event)</span> </span>{</span><br><span class="line">        <span class="comment">// Let the focused view and/or our descendants get the key first</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchKeyEvent(event) || executeKeyEvent(event);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * You can call this function yourself to have the scroll view perform</span></span><br><span class="line"><span class="comment">     * scrolling from a key event, just as if the event had been dispatched to</span></span><br><span class="line"><span class="comment">     * it by the view hierarchy.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event The key event to execute.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Return true if the event was handled, else false.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">executeKeyEvent</span><span class="params">(KeyEvent event)</span> </span>{</span><br><span class="line">        <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (event.getAction() == KeyEvent.ACTION_DOWN) {</span><br><span class="line">            <span class="keyword">switch</span> (event.getKeyCode()) {</span><br><span class="line">                <span class="keyword">case</span> KeyEvent.KEYCODE_DPAD_LEFT:</span><br><span class="line">                    handled = arrowScroll(FOCUS_LEFT);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> KeyEvent.KEYCODE_DPAD_RIGHT:</span><br><span class="line">                    handled = arrowScroll(FOCUS_RIGHT);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> KeyEvent.KEYCODE_TAB:</span><br><span class="line">                    <span class="keyword">if</span> (KeyEventCompat.hasNoModifiers(event)) {</span><br><span class="line">                        handled = arrowScroll(FOCUS_FORWARD);</span><br><span class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (KeyEventCompat.hasModifiers(event,</span><br><span class="line">                            KeyEvent.META_SHIFT_ON)) {</span><br><span class="line">                        handled = arrowScroll(FOCUS_BACKWARD);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> handled;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">arrowScroll</span><span class="params">(<span class="keyword">int</span> direction)</span> </span>{</span><br><span class="line">        View currentFocused = findFocus();</span><br><span class="line">        <span class="keyword">if</span> (currentFocused == <span class="keyword">this</span>)</span><br><span class="line">            currentFocused = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        View nextFocused = FocusFinder.getInstance().findNextFocus(<span class="keyword">this</span>,</span><br><span class="line">                currentFocused, direction);</span><br><span class="line">        <span class="keyword">if</span> (nextFocused != <span class="keyword">null</span> &amp;&amp; nextFocused != currentFocused) {</span><br><span class="line">            <span class="keyword">if</span> (direction == View.FOCUS_LEFT) {</span><br><span class="line">                <span class="comment">// If there is nothing to the left, or this is causing us to</span></span><br><span class="line">                <span class="comment">// jump to the right, then what we really want to do is page</span></span><br><span class="line">                <span class="comment">// left.</span></span><br><span class="line">                <span class="keyword">if</span> (currentFocused != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; nextFocused.getLeft() &gt;= currentFocused.getLeft()) {</span><br><span class="line">                    handled = pageLeft();</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    handled = nextFocused.requestFocus();</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (direction == View.FOCUS_RIGHT) {</span><br><span class="line">                <span class="comment">// If there is nothing to the right, or this is causing us to</span></span><br><span class="line">                <span class="comment">// jump to the left, then what we really want to do is page</span></span><br><span class="line">                <span class="comment">// right.</span></span><br><span class="line">                <span class="keyword">if</span> (currentFocused != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; nextFocused.getLeft() &lt;= currentFocused.getLeft()) {</span><br><span class="line">                    handled = pageRight();</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    handled = nextFocused.requestFocus();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (direction == FOCUS_LEFT || direction == FOCUS_BACKWARD) {</span><br><span class="line">            <span class="comment">// Trying to move left and nothing there; try to page.</span></span><br><span class="line">            handled = pageLeft();</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (direction == FOCUS_RIGHT || direction == FOCUS_FORWARD) {</span><br><span class="line">            <span class="comment">// Trying to move right and nothing there; try to page.</span></span><br><span class="line">            handled = pageRight();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (handled) {</span><br><span class="line">            playSoundEffect(SoundEffectConstants</span><br><span class="line">                    .getContantForFocusDirection(direction));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> handled;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">pageLeft</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mCurItem &gt; <span class="number">0</span>) {</span><br><span class="line">            setCurrentItem(mCurItem - <span class="number">1</span>, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">pageRight</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span> &amp;&amp; mCurItem &lt; (mAdapter.getCount() - <span class="number">1</span>)) {</span><br><span class="line">            setCurrentItem(mCurItem + <span class="number">1</span>, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * We only want the current page that is being shown to be focusable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFocusables</span><span class="params">(ArrayList&lt;View&gt; views, <span class="keyword">int</span> direction,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> focusableMode)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> focusableCount = views.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> descendantFocusability = getDescendantFocusability();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (descendantFocusability != FOCUS_BLOCK_DESCENDANTS) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) {</span><br><span class="line">                <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">                <span class="keyword">if</span> (child.getVisibility() == VISIBLE) {</span><br><span class="line">                    ItemInfo ii = infoForChild(child);</span><br><span class="line">                    <span class="keyword">if</span> (ii != <span class="keyword">null</span> &amp;&amp; ii.position == mCurItem) {</span><br><span class="line">                        child.addFocusables(views, direction, focusableMode);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// we add ourselves (if focusable) in all cases except for when we are</span></span><br><span class="line">        <span class="comment">// FOCUS_AFTER_DESCENDANTS and there are some descendants focusable.</span></span><br><span class="line">        <span class="comment">// this is</span></span><br><span class="line">        <span class="comment">// to avoid the focus search finding layouts when a more precise search</span></span><br><span class="line">        <span class="comment">// among the focusable children would be more interesting.</span></span><br><span class="line">        <span class="keyword">if</span> (descendantFocusability != FOCUS_AFTER_DESCENDANTS ||</span><br><span class="line">                <span class="comment">// No focusable descendants</span></span><br><span class="line">                (focusableCount == views.size())) {</span><br><span class="line">            <span class="comment">// Note that we can't call the superclass here, because it will</span></span><br><span class="line">            <span class="comment">// add all views in. So we need to do the same thing View does.</span></span><br><span class="line">            <span class="keyword">if</span> (!isFocusable()) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> ((focusableMode &amp; FOCUSABLES_TOUCH_MODE) == FOCUSABLES_TOUCH_MODE</span><br><span class="line">                    &amp;&amp; isInTouchMode() &amp;&amp; !isFocusableInTouchMode()) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (views != <span class="keyword">null</span>) {</span><br><span class="line">                views.add(<span class="keyword">this</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * We only want the current page that is being shown to be touchable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTouchables</span><span class="params">(ArrayList&lt;View&gt; views)</span> </span>{</span><br><span class="line">        <span class="comment">// Note that we don't call super.addTouchables(), which means that</span></span><br><span class="line">        <span class="comment">// we don't call View.addTouchables(). This is okay because a ViewPager</span></span><br><span class="line">        <span class="comment">// is itself not touchable.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) {</span><br><span class="line">            <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (child.getVisibility() == VISIBLE) {</span><br><span class="line">                ItemInfo ii = infoForChild(child);</span><br><span class="line">                <span class="keyword">if</span> (ii != <span class="keyword">null</span> &amp;&amp; ii.position == mCurItem) {</span><br><span class="line">                    child.addTouchables(views);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * We only want the current page that is being shown to be focusable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onRequestFocusInDescendants</span><span class="params">(<span class="keyword">int</span> direction,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                  Rect previouslyFocusedRect)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> index;</span><br><span class="line">        <span class="keyword">int</span> increment;</span><br><span class="line">        <span class="keyword">int</span> end;</span><br><span class="line">        <span class="keyword">int</span> count = getChildCount();</span><br><span class="line">        <span class="keyword">if</span> ((direction &amp; FOCUS_FORWARD) != <span class="number">0</span>) {</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">            increment = <span class="number">1</span>;</span><br><span class="line">            end = count;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            index = count - <span class="number">1</span>;</span><br><span class="line">            increment = -<span class="number">1</span>;</span><br><span class="line">            end = -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i != end; i += increment) {</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (child.getVisibility() == VISIBLE) {</span><br><span class="line">                ItemInfo ii = infoForChild(child);</span><br><span class="line">                <span class="keyword">if</span> (ii != <span class="keyword">null</span> &amp;&amp; ii.position == mCurItem) {</span><br><span class="line">                    <span class="keyword">if</span> (child.requestFocus(direction, previouslyFocusedRect)) {</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchPopulateAccessibilityEvent</span><span class="params">(AccessibilityEvent event)</span> </span>{</span><br><span class="line">        <span class="comment">// ViewPagers should only report accessibility info for the current</span></span><br><span class="line">        <span class="comment">// page,</span></span><br><span class="line">        <span class="comment">// otherwise things get very confusing.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Should this note something about the paging container?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childCount = getChildCount();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            <span class="keyword">final</span> View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (child.getVisibility() == VISIBLE) {</span><br><span class="line">                <span class="keyword">final</span> ItemInfo ii = infoForChild(child);</span><br><span class="line">                <span class="keyword">if</span> (ii != <span class="keyword">null</span> &amp;&amp; ii.position == mCurItem</span><br><span class="line">                        &amp;&amp; child.dispatchPopulateAccessibilityEvent(event)) {</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">PagerObserver</span> <span class="keyword">extends</span> <span class="title">DataSetObserver</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">()</span> </span>{</span><br><span class="line">            dataSetChanged();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInvalidated</span><span class="params">()</span> </span>{</span><br><span class="line">            dataSetChanged();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>上述代码替换原来的ViewPager即可</p>
<h1 id="设置ViewPager高度Wrap-Content使其随内容高度变化而变化"><a href="#设置ViewPager高度Wrap-Content使其随内容高度变化而变化" class="headerlink" title="设置ViewPager高度Wrap_Content使其随内容高度变化而变化"></a>设置ViewPager高度Wrap_Content使其随内容高度变化而变化</h1><p>继承自ViewPager</p>
<p>在原生的Viewpager组件中，在xml布局文件设置Viewpager的高度为wrap_content的时候，无论怎么设置内容内容，viewpager的视图都是以martch_parent的样式显示，除非给它设定固定的高度。</p>
<p>但是这样又不满足我们的需求，我们当然希望内容有多高，那么viewpager的高度就有多高，总不能第一个页面500dp，第二个页面的内容只有30dp，而第二个页面的高度有500dp高，这个总不符合需求的，所以需要viewpager计算出其子view的高度，然后重新设置viewpager的高度，代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sdr.binjiang.widget;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2017/11/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyWrapContentHeightViewPager</span> <span class="keyword">extends</span> <span class="title">LazyViewPager</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LazyWrapContentHeightViewPager</span><span class="params">(Context context)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LazyWrapContentHeightViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> height = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) {</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            child.measure(widthMeasureSpec, MeasureSpec.makeMeasureSpec(<span class="number">0</span>, MeasureSpec.UNSPECIFIED));</span><br><span class="line">            <span class="keyword">int</span> h = child.getMeasuredHeight();</span><br><span class="line">            <span class="keyword">if</span>(h &gt; height) height = h;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        heightMeasureSpec = MeasureSpec.makeMeasureSpec(height, MeasureSpec.EXACTLY);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/Android">Android</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  




  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "【Android】懒加载的ViewPager+自适应高度&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>







</body>
</html>
